{{ block title }}

<p style="text-align: center; font-size: 26px;  "> Decision {{player.round_number}} </p>

{{ endblock }}
{{ block content }}


<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1.0">


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

/////////// global variables

    //let TP_decisions_stored = [0, 0, 0, 0]; // Array to store selected values for each row
    let TP_norm_decisions_stored = [0, 0, 0, 0]; // Array to store selected values for each row
    let TP_neg_norm_decisions_stored = [0, 0, 0, 0];

    var current_treatment = "{{ treatment }}";
    //console.log("Current treatment:", current_treatment );

    const TP_points = {{ C.TP_points }}; // third party points
    const TP_eff = {{ C.TP_effectiveness }}; // punishment or reward or victim compensation effectiveness
    const TP_cost = {{ C.TP_cost }}; // cost to the third party for punish or reward or compensation

    const TP_decisions = {{ TP_decisions | safe }};
    const TP_norm_decisions = {{ TP_norm_decisions | safe }};
    //console.log('TP decisions:', {{ TP_decisions | safe }});
    //console.log('Norm decisions:', {{ TP_norm_decisions | safe }});

    // Store last clicked row type
    let lastClickedRowType = null;
    let lastClickedIndex = null;
    let lastClickedValue = 0;

    /// Function for showing customized error messages
    const errorDiv = document.querySelector('.otree-form-errors');

    if (errorDiv) {
        errorDiv.textContent = 'Please make a decision to continue.'
    }


/////////// All the functions (for TP_decisions) related to hovering and coinstacks/labels updating
/////////// had to be moved out of the large parent function.

    // function to update the coin stack (TP_decisions only)
    function updateCoinStack(value, index, row) {

        const TP_decision = TP_decisions.find((d) => d.index === parseInt(index, 10));

        TPupdate = TP_points - value// third party updating
        Dupdate = TP_decision.dictator_keeps - (value* TP_eff) // dictator updating
        DesRupdate = value* TP_eff // destruction and reward updating
        Cupdate = value* TP_eff // compensation updating

        if (Dupdate < 0 && (current_treatment.includes("punish") || current_treatment.includes("3PP country") || current_treatment.includes("comp"))) { // if Dupdate is less than 0 & we are in punishment condition
            DesRupdate = DesRupdate + Dupdate // Set DesRupdate to max endowment (not more)
            Dupdate = 0; // Set Dupdate to 0 if it's less than 0
        }

        if (current_treatment.includes("reward")) { // leave dictator coins if 3PR
            Dupdate = TP_decision.dictator_keeps
        }

        // Only updates in TP decision condition
        if (!current_treatment.includes("norm") ) {
            // Clear existing stacks
            if (row === "punish") {
                $(`.coinstackTP[data-index="${index}"]`).empty();
                //console.log('Cleared coinstackTP for index:', index);
                $(`.coinstackD[data-index="${index}"]`).empty();
                //console.log('Cleared coinstackD for index:', index);
                $(`.coinstackDDes[data-index="${index}"]`).empty();
                $(`.coinstackDDes2PP[data-index="${index}"]`).empty();
                //console.log('Cleared coinstackDDes for index:', index);
                $(`.coinstackTP2PP[data-index="${index}"]`).empty();
                $(`.coinstackTP3PR[data-index="${index}"]`).empty();
            }
            if (row === "compensate") {
                $(`.coinstackTP3PC[data-index="${index}"]`).empty();
            }

            // Add the specified number of coins
            if (row === "punish") { // prevent the punishment stacks update in compensation treatments only
                for (let i = 0; i < TPupdate; i++) {
                    $(`.coinstackTP[data-index="${index}"]`).append('<div class="coinown" style="left:75%;"></div>');
                }

                for (let i = 0; i < Dupdate; i++) {
                    $(`.coinstackD[data-index="${index}"]`).append('<div class="coin" style="left:19%;"></div>');
                }

                for (let i = 0; i < DesRupdate; i++) {
                    $(`.coinstackDDes[data-index="${index}"]`).append('<div class="coin_destroyed" style="left:5%;"></div>');
                }
            }

            // Update other stacks for subconditions: 2PP, 2PR, 3PC
            for (let i = 0; i < TPupdate; i++) {
                $(`.coinstackTP2PP[data-index="${index}"]`).append('<div class="coinown2PP" style="left:83%;"></div>');
            }

            for (let i = 0; i < DesRupdate; i++) {
                $(`.coinstackTP3PR[data-index="${index}"]`).append('<div class="coinown3PR" style="left:7%;"></div>');
            }

            for (let i = 0; i < Cupdate; i++) {
                $(`.coinstackTP3PC[data-index="${index}"]`).append('<div class="coinown3PC" style="left:102%;"></div>');
            }

            for (let i = 0; i < DesRupdate; i++) {
                $(`.coinstackDDes2PP[data-index="${index}"]`).append('<div class="coin_destroyed2PP" style="left:65%;"></div>');
            }

            // Update the number labels
            if (row === "punish") {
                $(`#countTP[data-index="${index}"]`).text(`${TPupdate}`);
                //console.log('coin number for index:', index);
                $(`#countD[data-index="${index}"]`).text(`${Dupdate}`);
                $(`#countDDes[data-index="${index}"]`).text(`${DesRupdate}`);
                $(`#countDDes2PP[data-index="${index}"]`).text(`${DesRupdate}`);
                $(`#countTP2PP[data-index="${index}"]`).text(`${TPupdate}`);
                $(`#countTP3PR[data-index="${index}"]`).text(`${DesRupdate}`);
            }
            if (row === "compensate") {
                $(`#countTP3PC[data-index="${index}"]`).text(`${Cupdate}`);
            }
        }

        //Debugging
        //console.log(`updateCoinStack called - Count: ${count}, Index: ${index}, Row: ${row}`);
        //console.log(`Calculated TPupdate: ${TPupdate}, Dupdate: ${Dupdate}, DesRupdate: ${DesRupdate}`);
    }

    // Hover function calling updateCoinStack - Updates the hovered row and resets the other row
    $(document).on('mouseenter', '.number', function () {
        const value = $(this).data('value');  // Get number value
        const index = $(this).data('index');  // Get the index
        const row = $(this).closest('.number-row-comp').length ? "compensate" : "punish"; // Detect row type

        //console.log('Hover triggered. Value:', value, 'Index:', index, 'Row:', row);

        // Update the hovered stack
        updateCoinStack(value, index, row);

        // Reset the other stack while hovering
        const otherRow = row === "punish" ? "compensate" : "punish";
        updateCoinStack(0, index, otherRow);
    });

    // Restore function - Ensures only one stack stays updated after hovering
    function restoreRowState(index) {
        if (lastClickedRowType && lastClickedIndex === index) {
            updateCoinStack(lastClickedValue, index, lastClickedRowType); // Restore clicked stack
            updateCoinStack(0, index, lastClickedRowType === "punish" ? "compensate" : "punish"); // Reset other stack
            //console.log(`Restoring last clicked stack: ${lastClickedRowType} at index ${index}`);
        } else {
            // Reset both if nothing was clicked
            updateCoinStack(0, index, "punish");
            updateCoinStack(0, index, "compensate");
            //console.log(`Resetting both stacks at index ${index}`);
        }
    }

    // Mouse leave function - Ensures only one updated stack remains
    $(document).on('mouseleave', '.number-row, .number-row-comp', function () {
        const index = $(this).data('index');
        restoreRowState(index);
    });


////////////// function for displaying the task, numbers, and labels and managing the click event
    $(document).ready(function () {

        TP_decision_effect = 0 // dictator or recipient points that are destroyed by punishment or added by reward/compensation

        // country pictures from https://github.com/irixapps/World-Flags/tree/master
        // naming convention: https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2

        receiverCountry = "{{ recip_identity }}"
        dictatorCountry = "{{ dic_identity }}"

        // role_switch_true = "{{ role_switch_true }}"

        if (receiverCountry == "out") {
            receiverCountryName = "one of 40 countries"
        }


        /////////////// script

        // get flags
        $('.receiverCountry').attr('src', '/static/global/flags/' + receiverCountry +'.png');
        $('.dictatorCountry').attr('src', '/static/global/flags/' + dictatorCountry +'.png');

        // get maps
        $('.receiverCountryMap').attr('src', '/static/global/worldmap/' + receiverCountry +'.png');
        $('.dictatorCountryMap').attr('src', '/static/global/worldmap/' + dictatorCountry +'.png');


        // only in TP_decision conditions
        if (!current_treatment.includes("norm") ) {

            // Initialize coin stacks for each TP decision
            TP_decisions.forEach((TP_decision) => {
                const index = TP_decision.index;
                const dictatorKeeps = TP_decision.dictator_keeps;
                const receiverGets = TP_decision.receiver;

                // Set the default display text for TP cost
                $(`.TP-cost-display[data-index="${index}"]`).text('_');


                // Fill initial coin stacks
                // dictator stack
                for (let i = 0; i < dictatorKeeps; i++) {
                    $(`.coinstackD[data-index="${index}"]`).append('<div class="coin" style="left:19%;"></div>');
                }
                // red stack (destructed coins)
                for (let i = 0; i < TP_decision_effect; i++) {
                    $(`.coinstackDDes[data-index="${index}"]`).append('<div class="coinown" style="left:75%;"></div>></div>');
                }
                // punisher stack
                for (let i = 0; i < TP_points; i++) {
                    $(`.coinstackTP[data-index="${index}"]`).append('<div class="coinown" style="left:75%;"></div>></div>');
                }
                // receiver stack
                for (let i = 0; i < receiverGets; i++) {
                    $(`.coinstackR[data-index="${index}"]`).append('<div class="coinR" style="left:50%;"></div>');
                }

                // Extra stacks in different locations
                // punisher in 2PP punisher stack
                for (let i = 0; i < TP_points; i++) {
                    $(`.coinstackTP2PP[data-index="${index}"]`).append('<div class="coinown2PP" style="left:83%;"></div>');
                }
                // DG reward in 3PR
                for (let i = 0; i < TP_decision_effect; i++) {
                    $(`.coinstackTP3PR[data-index="${index}"]`).append('<div class="coinown3PR" style="left:7%;"></div>');
                }
                // recipient compensation in 3PC
                for (let i = 0; i < TP_decision_effect; i++) {
                    $(`.coinstackTP3PC[data-index="${index}"]`).append('<div class="coinown3PC" style="left:102%;"></div>');
                }
                // Destroyed coins 2PP
                for (let i = 0; i < TP_decision_effect; i++) {
                    $(`.coinstackDDes2PP[data-index="${index}"]`).append('<div class="coinown" style="left:75%;"></div>></div>');
                }


                // Initialize number labels
                $('#countTP[data-index="' + index + '"]').text(`${TP_points}`);
                $('#countD[data-index="' + index + '"]').text(`${dictatorKeeps}`);
                $('#countR[data-index="' + index + '"]').text(`${receiverGets}`);
                $('#countTP2PP[data-index="' + index + '"]').text(`${TP_points}`);
                // You can also initialize other labels like countDDes, countTP3PR, etc. if needed
                $('#countDDes[data-index="' + index + '"]').text(`${TP_decision_effect}`);
                $('#countDDes2PP[data-index="' + index + '"]').text(`${TP_decision_effect}`);
                $('#countTP3PR[data-index="' + index + '"]').text(`${TP_decision_effect}`);
                $('#countTP3PC[data-index="' + index + '"]').text(`${TP_decision_effect}`);
            });

            // deactive punishment that would generate negative values
            let numbersToDisable = [];
            TP_decisions.forEach(TP_decision => {
                // Calculate the maximum punishment value possible based on the dictator's kept coins
                DPpossible = Math.ceil(TP_decision.dictator_keeps / TP_eff);

                // Generate the numbers that should be disabled (punishment numbers that exceed possible value)
                for (let i = DPpossible + 1; i <= TP_points; i++) {
                    numbersToDisable.push(i); // Add all numbers that are larger than the max possible punishment value
                }

                // Only deactivate numbers in the "punish" row for specific treatments (including "3PC comp")
                if (current_treatment.includes("punish") || current_treatment.includes("3PC comp") || current_treatment.includes("3PP country")) {
                    // Ensure we only disable punishment numbers for the "punish" row
                    deactivateNumbers(numbersToDisable, TP_decision.index, "punish");
                }
            });

            // Formatting function to display TP cost nicely
            function formatNumber(num) {
                return Number.isInteger(num) ? num.toString() : num.toFixed(2);
            }

            // Click function - Stores last clicked stack and updates accordingly
            $('.number').on('click', function () {
                // Remove 'selected' class from all buttons
                $(this).closest('.numbers').find('.number').removeClass('selected');

                // Add 'selected' class to the clicked button
                $(this).addClass('selected');

                // Get values
                const value = $(this).data('value');
                const index = $(this).data('index');
                const row = $(this).closest('.number-row-comp').length ? "compensate" : "punish";

                // Update the corresponding punishment value in the array
                //TP_decisions_stored[index - 1] = value;

                // Update the hidden input field
                $(`#selected-number-${index}`).val(value);

                // Update the hidden input field for the selected action
                let rowValue = row === "punish" ? 0 : 1; //because integer in python
                $("#selected-action-" + index).val(rowValue);

                // Store clicked values
                lastClickedRowType = row;
                lastClickedIndex = index;
                lastClickedValue = value;

                costTP = formatNumber(value / TP_cost)

                // Update the display text for TP cost
                $(`.TP-cost-display[data-index="${index}"]`).text(costTP);

                // Update the clicked stack
                updateCoinStack(value, index, row);

                // Reset the other stack
                const otherRow = row === "punish" ? "compensate" : "punish";
                updateCoinStack(0, index, otherRow);

                console.log(`Clicked decision at index ${index} (${row}): ${value}`);
                //console.log(`Punishment values: ${TP_decisions_stored}`);
                console.log(`After updating input: #selected-number-${index}, value:`, $(`#selected-number-${index}`).val()); // Log updated value

            });
        }

        // Fill initial coin stacks and number labels for each TP NORM question
        // Also includes response collection (different function for TP decision)
        if (current_treatment.includes("norm") ) { // in norm condition

            // Is this for the text?
            //document.getElementById("norm_fixed_amount").textContent = norm_fixed_amount;

            TP_norm_decisions.forEach((TP_norm_decision) => {
                const index = TP_norm_decision.index;
                let dictatorKeeps = TP_norm_decision.dictator_keeps;
                const receiverGets = TP_norm_decision.receiver;
                const norm_TP_points = {{ C.norm_fixed_TP_points }}

                // leave dictator coins if 3PR or 3PC, remove the norm_TP_points if 2PP or 3PP
                // Update: We are NOT displaying updated coin stacks for 3PP/2PP norms!
                dictatorKeeps = TP_norm_decision.dictator_keeps
                // if (current_treatment.includes("reward") || current_treatment.includes("comp")) {
                //     dictatorKeeps = TP_norm_decision.dictator_keeps
                // } else if (current_treatment.includes("punish") || current_treatment.includes("3PP country")) {
                //     dictatorKeeps = TP_norm_decision.dictator_keeps-norm_TP_points
                // }

                    // dictator stack
                    for (let i = 0; i < dictatorKeeps; i++) {
                        $(`.coinstackD[data-index="${index}"]`).append('<div class="coin" style="left:19%;"></div>');
                    }
                    // red stack (destructed coins)
                    for (let i = 0; i < norm_TP_points; i++) {
                        $(`.coinstackDDes[data-index="${index}"]`).append('<div class="coin_destroyed" style="left:19%;"></div>');
                    }
                    // punisher stack
                    for (let i = 0; i < norm_TP_points; i++) {
                        $(`.coinstackTP[data-index="${index}"]`).append('<div class="coinown" style="left:75%;"></div>></div>');
                    }
                    // receiver stack
                    for (let i = 0; i < receiverGets; i++) {
                        $(`.coinstackR[data-index="${index}"]`).append('<div class="coinR" style="left:50%;"></div>');
                    }

                    // Extra stacks in different locations
                    // punisher in 2PP punisher stack
                    for (let i = 0; i < TP_points; i++) {
                        $(`.coinstackTP2PP[data-index="${index}"]`).append('<div class="coinown2PP" style="left:83%;"></div>');
                    }
                    // DG reward in 3PR
                    for (let i = 0; i < TP_points; i++) {
                        $(`.coinstackTP3PR[data-index="${index}"]`).append('<div class="coinown3PR" style="left:7%;"></div>');
                    }
                    // recipient compensation in 3PC
                    for (let i = 0; i < TP_points; i++) {
                        $(`.coinstackTP3PC[data-index="${index}"]`).append('<div class="coinown3PC" style="left:102%;"></div>');
                    }
                    // destroyed coins for 2PP
                    for (let i = 0; i < norm_TP_points; i++) {
                        $(`.coinstackDDes2PP[data-index="${index}"]`).append('<div class="coin_destroyed2PP" style="left:19%;"></div>');
                    }

                    // number labels
                    $('#countTP[data-index="' + index + '"]').text(`${norm_TP_points}`);
                    $('#countD[data-index="' + index + '"]').text(`${dictatorKeeps}`);
                    $('#countR[data-index="' + index + '"]').text(`${receiverGets}`);
                    $('#countTP2PP[data-index="' + index + '"]').text(`${norm_TP_points}`);
                    $('#countDDes[data-index="' + index + '"]').text(`${norm_TP_points}`);
                    $('#countDDes2PP[data-index="' + index + '"]').text(`${norm_TP_points}`);
                    $('#countTP3PR[data-index="' + index + '"]').text(`${norm_TP_points}`);
                    $('#countTP3PC[data-index="' + index + '"]').text(`${norm_TP_points}`);

                    //Debugging
                    //console.log('Dictator stack - Index:', index, 'Coins:', dictatorKeeps);
                    //console.log('Receiver stack - Index:', index, 'Coins:', receiverGets);
                    //console.log('Norm fixed amount - Index:', index, 'Effect:', norm_fixed_amount);

            });

            // Collect responses for each separate question
            $('.norm').on('click', function () {
                // Remove 'selected' class from all buttons
                $(this).closest('.number-row').find('.norm').removeClass('selected');

                // Add 'selected' class to the clicked button
                $(this).addClass('selected');

                // Get the value of the clicked button
                const value = $(this).data('value');
                const index = $(this).data('index');

                // Update the corresponding punishment value in the array
                TP_norm_decisions_stored[index - 1] = value;

                // Update the hidden input field
                $(`#selected-norm-${index}`).val(value);

                // Debugging
                //console.log(`Updated norm decision at index ${index}: ${value}`);
                //console.log(`Norm values: ${TP_norm_decisions_stored}`);
            });

            $('.neg-norm').on('click', function () {
                // Remove 'selected' class from all buttons
                $(this).closest('.number-row').find('.neg-norm').removeClass('selected');

                // Add 'selected' class to the clicked button
                $(this).addClass('selected');

                // Get the value of the clicked button
                const value = $(this).data('value');
                const index = $(this).data('index');

                // Update the corresponding punishment value in the array
                TP_neg_norm_decisions_stored[index - 1] = value;

                // Update the hidden input field
                $(`#selected-neg-norm-${index}`).val(value);

                // Debugging
                //console.log(`Updated norm decision at index ${index}: ${value}`);
                //console.log(`neg Norm values: ${TP_neg_norm_decisions_stored}`);
            });
        }

        function deactivateNumbers(numbersToDisable, index, row) {
        // Only deactivate numbers for the "punish" row
            numbersToDisable.forEach(num => {
                // Add 'disabled' class to numbers that are not allowed for the "punish" row
                $('.number[data-value="' + num + '"][data-index="' + index + '"][data-row="punish"]').addClass('disabled');  // Target only the "punish" row numbers
            });
        }

        // Submit button click handler
        $('#submit-button').on('click', function () {
            // Submit the form
            $('form').submit();
        });

    });
</script>


<style>

    body {
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin-top: 4vw;
        background-color: #f4f4f4;
    }

    .number-row {
        justify-content: center;
        display: flex;
        margin-top:1vw;
        /*gap: 1vw; !* Space between numbers scales with viewport width *!*/
        gap: 0.2vw; /* Space between numbers scales with viewport width */
        flex-wrap: wrap; /* Optional: allows wrapping if buttons exceed container width */
        align-items: center; /* Ensures proper vertical alignment */
    }

    .number-row-comp {
        justify-content: center;
        display: flex;
        margin-top:1vw;
        /*gap: 1vw; !* Space between numbers scales with viewport width *!*/
        gap: 0.2vw; /* Space between numbers scales with viewport width */
        flex-wrap: wrap; /* Optional: allows wrapping if buttons exceed container width */
        align-items: center; /* Ensures proper vertical alignment */
    }

    .number {
        width: 2.8vw; /* Width scales with viewport width */
        height: 3vw; /* Height scales with viewport width */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5vw; /* Font size scales with viewport width */
        background-color: #e0e0e0;
        border: 2px solid #000000;
        border-radius: 10%; /* Slightly rounded corners */
        cursor: pointer;
        font-family: Arial, Helvetica, sans-serif;
        transition: background-color 0.3s ease;
    }

    .norm {
        width: 6vw; /* Width scales with viewport width */
        height: 5vw; /* Height scales with viewport width */
        flex-direction: column;
        text-align: center; /* Center-aligns the text */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.9vw; /* Font size scales with viewport width */
        background-color: #e0e0e0;
        border: 2px solid #000000;
        border-radius: 10%; /* Slightly rounded corners */
        cursor: pointer;
        font-family: Arial, Helvetica, sans-serif;
        transition: background-color 0.3s ease;
    }

    .neg-norm {
        width: 6vw; /* Width scales with viewport width */
        height: 5vw; /* Height scales with viewport width */
        flex-direction: column;
        text-align: center; /* Center-aligns the text */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.9vw; /* Font size scales with viewport width */
        background-color: #e0e0e0;
        border: 2px solid #000000;
        border-radius: 10%; /* Slightly rounded corners */
        cursor: pointer;
        font-family: Arial, Helvetica, sans-serif;
        transition: background-color 0.3s ease;
    }

    .number:hover {
        background-color: #ffcc00; /* Change background color on hover */
    }

    .number:active {
        background-color: #ffa500; /* Change background color on click */
    }

    .number.selected {
             background-color: #ffa500; /* Permanent color when clicked */
    }

    .number.disabled {
        background-color: #F3F3F3; /* Grey color for disabled buttons */
        border: 2px solid #d3d3d3;
        color:#d3d3d3;
        cursor: not-allowed;
        pointer-events: none; /* Disable interactions */
    }

    .norm:hover {
        background-color: #ffcc00; /* Change background color on hover */
    }

    .norm:active {
        background-color: #ffa500; /* Change background color on click */
    }

    .norm.selected {
             background-color: #ffa500; /* Permanent color when clicked */
    }

    .norm.disabled {
        background-color: #F3F3F3; /* Grey color for disabled buttons */
        border: 2px solid #d3d3d3;
        color:#d3d3d3;
        cursor: not-allowed;
        pointer-events: none; /* Disable interactions */
    }

    .neg-norm:hover {
        background-color: #ffcc00; /* Change background color on hover */
    }

    .neg-norm:active {
        background-color: #ffa500; /* Change background color on click */
    }

    .neg-norm.selected {
             background-color: #ffa500; /* Permanent color when clicked */
    }

    .neg-norm.disabled {
        background-color: #F3F3F3; /* Grey color for disabled buttons */
        border: 2px solid #d3d3d3;
        color:#d3d3d3;
        cursor: not-allowed;
        pointer-events: none; /* Disable interactions */
    }

    .responsive-div {
      width: 90%; /* Default width */
      transform-origin: top left; /* Ensure scaling starts from top-left */
      transform: scale(1); /* Default scale */
      transition: transform 0.3s ease; /* Smooth scaling */
      /*border:1px solid black;*/
      margin-left:auto;
      margin-right:auto;
    }

    .container {
        width:45%;
        height:25vw;
        margin-left:auto;
        margin-right:auto;
        border:0px solid black;
        position:relative;
    }

    .short-container {
        width:45%;
        height:15vw;  # shorter for dictator
        margin-left:auto;
        margin-right:auto;
        border:0px solid black;
        position:relative;
    }

    .reminder {
        background-color: #e0f0ff;
        color: #004080;
        border: 1px solid #004080;
        padding: 8px;
        margin-top: 15px;
        border-radius: 5px;
        font-size: 14px;
    }

    @media (max-width: 1200px) {
      .responsive-div {
        transform: scale(1.0); /* Scale to 80% for smaller screens */
      }
      .container {
          margin-left:10vw;
      }
      .numbers {
          position:absolute;
          transform: scale(0.95);
          left:6vw;
      }
    }

    @media (max-width: 800px) {
      .responsive-div {
        transform: scale(2); /* Scale to 60% for even smaller screens */
      }
      .container {
          margin-left:1vw;
      }
      .numbers {
          position:absolute;
          transform: scale(0.95);
          left:-3.2vw;
      }
      .number {
          font-size:2vw;
          border-width:1px;
      }
    }

    .coin-stack {
        position: absolute;
        width: 5vw; /* The stack width adjusts to 20% of the viewport width */
        max-width: 100px; /* Ensure coins don't get too big */
    }

    .coin {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coinR {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coin_destroyed {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background-color: rgba(255, 0, 0, 0.15); /* Semi-transparent red (0.5 is 50% transparency) */
        /*background: linear-gradient(145deg, #ffd700, #e6c200);*/
        /*border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        /*box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);*/
        position: absolute;
        transform: translateX(-50%);
}

    .coin_destroyed2PP {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background-color: rgba(255, 0, 0, 0.15); /* Semi-transparent red (0.5 is 50% transparency) */
        /*background: linear-gradient(145deg, #ffd700, #e6c200);*/
        /*border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        /*box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);*/
        position: absolute;
        transform: translateX(-50%);
}

    .coinown {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        /*border: 0.1vw solid #FFFFFF; !* Border size scales with the coin size *!*/
        border: 0.1vw solid darkred; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coinown2PP {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        /*border: 0.1vw solid #FFFFFF; !* Border size scales with the coin size *!*/
        border: 0.1vw solid darkred; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coinown3PR {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coinown3PC {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coin-count-labelD {
    font-size: 1.2rem;
    color: #333; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 30%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 32%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelDDes {
    font-size: 1.2rem;
    color: rgba(255, 0, 0, 0.15); /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: -4%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 56%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelDDes2PP {
    font-size: 1.2rem;
    color: rgba(255, 0, 0, 0.15); /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 76%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: -10%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelR {
    font-size: 1.2rem;
    color: #333; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 60%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 13%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelTP {
    font-size: 1.2rem;
    color: darkred; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 85%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 80%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelTP2PP {
    font-size: 1.2rem;
    color: darkred; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 73%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 8%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelTP3PR {
    font-size: 1.2rem;
    color: #333; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: -4%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 56%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelTP3PC {
    font-size: 1.2rem;
    color: #333; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 111%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 56%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin:nth-child(12)  { top: 6.0vw; }
    .coin:nth-child(11)  { top: 6.3vw; }
    .coin:nth-child(10)  { top: 6.6vw; }
    .coin:nth-child(9)   { top: 6.9vw; }
    .coin:nth-child(8)   { top: 7.2vw; }
    .coin:nth-child(7)   { top: 7.5vw; }
    .coin:nth-child(6)   { top: 7.8vw; }
    .coin:nth-child(5)   { top: 8.1vw; }
    .coin:nth-child(4)   { top: 8.4vw; }
    .coin:nth-child(3)   { top: 8.7vw; }
    .coin:nth-child(2)   { top: 9.0vw; }
    .coin:nth-child(1)   { top: 9.3vw; }

    .coinR:nth-child(12)  { top: 1.3vw; }
    .coinR:nth-child(11)  { top: 1.6vw; }
    .coinR:nth-child(10)  { top: 1.9vw; }
    .coinR:nth-child(9)   { top: 2.2vw; }
    .coinR:nth-child(8)   { top: 2.5vw; }
    .coinR:nth-child(7)   { top: 2.8vw; }
    .coinR:nth-child(6)   { top: 3.1vw; }
    .coinR:nth-child(5)   { top: 3.4vw; }
    .coinR:nth-child(4)   { top: 3.7vw; }
    .coinR:nth-child(3)   { top: 4.0vw; }
    .coinR:nth-child(2)   { top: 4.3vw; }
    .coinR:nth-child(1)   { top: 4.6vw; }

    .coinown:nth-child(10)  { top: 18.8vw; }
    .coinown:nth-child(9)   { top: 19.1vw; }
    .coinown:nth-child(8)   { top: 19.4vw; }
    .coinown:nth-child(7)   { top: 19.7vw; }
    .coinown:nth-child(6)   { top: 20.0vw; }
    .coinown:nth-child(5)   { top: 20.3vw; }
    .coinown:nth-child(4)   { top: 20.6vw; }
    .coinown:nth-child(3)   { top: 20.9vw; }
    .coinown:nth-child(2)   { top: 21.2vw; }
    .coinown:nth-child(1)   { top: 21.5vw; }

    .coinown2PP:nth-child(10)  { top: 0.6vw; }
    .coinown2PP:nth-child(9)   { top: 0.9vw; }
    .coinown2PP:nth-child(8)   { top: 1.2vw; }
    .coinown2PP:nth-child(7)   { top: 1.5vw; }
    .coinown2PP:nth-child(6)   { top: 1.8vw; }
    .coinown2PP:nth-child(5)   { top: 2.1vw; }
    .coinown2PP:nth-child(4)   { top: 2.4vw; }
    .coinown2PP:nth-child(3)   { top: 2.7vw; }
    .coinown2PP:nth-child(2)   { top: 3.0vw; }
    .coinown2PP:nth-child(1)   { top: 3.3vw; }


    .coinown3PR:nth-child(1)  { top: 15.8vw; }
.coinown3PR:nth-child(2)  { top: 15.5vw; }
.coinown3PR:nth-child(3)  { top: 15.2vw; }
.coinown3PR:nth-child(4)   { top: 14.9vw; }
.coinown3PR:nth-child(5)   { top: 14.6vw; }
.coinown3PR:nth-child(6)   { top: 14.3vw; }
.coinown3PR:nth-child(7)   { top: 14.0vw; }
.coinown3PR:nth-child(8)   { top: 13.7vw; }
.coinown3PR:nth-child(9)   { top: 13.4vw; }
.coinown3PR:nth-child(10)   { top: 13.1vw; }
.coinown3PR:nth-child(11)   { top: 12.8vw; }
.coinown3PR:nth-child(12)   { top: 12.5vw; }

.coinown3PC:nth-child(1)  { top: 15.8vw; }
.coinown3PC:nth-child(2)  { top: 15.5vw; }
.coinown3PC:nth-child(3)  { top: 15.2vw; }
.coinown3PC:nth-child(4)   { top: 14.9vw; }
.coinown3PC:nth-child(5)   { top: 14.6vw; }
.coinown3PC:nth-child(6)   { top: 14.3vw; }
.coinown3PC:nth-child(7)   { top: 14.0vw; }
.coinown3PC:nth-child(8)   { top: 13.7vw; }
.coinown3PC:nth-child(9)   { top: 13.4vw; }
.coinown3PC:nth-child(10)   { top: 13.1vw; }
.coinown3PC:nth-child(11)   { top: 12.8vw; }
.coinown3PC:nth-child(12)   { top: 12.5vw; }

.coin_destroyed:nth-child(1)  { top: 15.8vw; }
.coin_destroyed:nth-child(2)  { top: 15.5vw; }
.coin_destroyed:nth-child(3)  { top: 15.2vw; }
.coin_destroyed:nth-child(4)   { top: 14.9vw; }
.coin_destroyed:nth-child(5)   { top: 14.6vw; }
.coin_destroyed:nth-child(6)   { top: 14.3vw; }
.coin_destroyed:nth-child(7)   { top: 14.0vw; }
.coin_destroyed:nth-child(8)   { top: 13.7vw; }
.coin_destroyed:nth-child(9)   { top: 13.4vw; }
.coin_destroyed:nth-child(10)   { top: 13.1vw; }
.coin_destroyed:nth-child(11)   { top: 12.8vw; }
.coin_destroyed:nth-child(12)   { top: 12.5vw; }

.coin_destroyed2PP:nth-child(12)  { top: -3.3vw; }
    .coin_destroyed2PP:nth-child(11)  { top: -3.0vw; }
    .coin_destroyed2PP:nth-child(10)  { top: -2.7vw; }
    .coin_destroyed2PP:nth-child(9)   { top: -2.4vw; }
    .coin_destroyed2PP:nth-child(8)   { top: -2.1vw; }
    .coin_destroyed2PP:nth-child(7)   { top: -1.8vw; }
    .coin_destroyed2PP:nth-child(6)   { top: -1.5vw; }
    .coin_destroyed2PP:nth-child(5)   { top: -1.2vw; }
    .coin_destroyed2PP:nth-child(4)   { top: -0.9vw; }
    .coin_destroyed2PP:nth-child(3)   { top: -0.6vw; }
    .coin_destroyed2PP:nth-child(2)   { top: -0.3vw; }
    .coin_destroyed2PP:nth-child(1)   { top: 0.0vw; }




</style>
</head>


<body>

    <form method="post">

        {% if "norm" in player.treatment %}

        <input type="hidden" name="TP_norm_decision1" id="selected-norm-1">


<!--        {{ formfield_errors 'TP_norm_decision1' }}-->

            {% if "punish" in player.treatment or "reward" in player.treatment %}

            <input type="hidden" name="TP_neg_norm_decision1" id="selected-neg-norm-1">
<!--            {{ formfield_errors 'TP_neg_norm_decision1' }}-->

            {% endif %}

        {% else %}

        <!-- Add hidden input to store the selected value -->
        <input type="hidden" name="TP_decision1" id="selected-number-1">
        <input type="hidden" name="TP_decision2" id="selected-number-2">
        <input type="hidden" name="TP_decision3" id="selected-number-3">

<!--        {{ formfield_errors 'TP_decision1' }}-->
<!--        {{ formfield_errors 'TP_decision2' }}-->
<!--        {{ formfield_errors 'TP_decision3' }}-->

            {% if "comp" in player.treatment %}

            <input type="hidden" name="punish_or_compensate1" id="selected-action-1">
            <input type="hidden" name="punish_or_compensate2" id="selected-action-2">
            <input type="hidden" name="punish_or_compensate3" id="selected-action-3">
<!--            {{ formfield_errors 'punish_or_compensate1' }}-->
<!--            {{ formfield_errors 'punish_or_compensate2' }}-->
<!--            {{ formfield_errors 'punish_or_compensate3' }}-->

            {% endif %}

        {% endif %}


        {% if "norm" in player.treatment %}

        {% if "2PP" in player.treatment and player.round_number < 6 %}
            <b> Now, you decide how <b style="color: red;">socially appropriate</b> the decision of Person B is.</b> <br> <br>
            <p style="font-size: 14px; ">
                Importantly, you will receive an <b>extra bonus of 10 points</b> if your decisions are the same as the most
                common decisions among all other participants in {{current_country}}. <br> <br>
            </p>
        {% endif %}

        {% if "3PP" in player.treatment or "3PR" in player.treatment or "3PC" in player.treatment %}
            <b> Now, you decide how <b style="color: red;">socially appropriate</b> the decision of Person C is.</b> <br> <br>
        {% endif %}

        {% for TP_norm_decision in TP_norm_decisions %}
        <div class='responsive-div'>
            <div class="container {% if '2PP' in player.treatment %}short-container{% endif %}" data-index="{{ TP_norm_decision.index }}">

                {% if dic_identity != "baseline"%}
                    <img src="" style='width:50%; position:absolute; right:17.5vw' class='dictatorCountry'>
                    <img src="" style='width:50%; position:absolute; left:17.8vw' class='receiverCountry'>

                    <img src="" style='width:50%; position:absolute; top:7vw; right:22vw' class='dictatorCountryMap'>
                    <img src="" style='width:50%; position:absolute; top:7vw; left:22vw' class='receiverCountryMap'>
                {% endif %}

                <img src="/static/{{ image }}" style="width:27vw; position:absolute; left:-25%; top:3vw">

                {% if "0DG" in player.treatment or "2PP" in player.treatment %}
                    <p>
                        <b style="position: absolute; top: 60%; left:-25%;">PERSON A</b>
                    </p>
                    <p>
                        <b style="position: absolute; top: 60%; right:-27%;">PERSON B</b>
                    </p>
                {% else %}
                    <p>
                        <b style="position: absolute; top: 36%; left:-25%;">PERSON A</b>
                    </p>
                    <p>
                        <b style="position: absolute; top: 36%; right:-27%;">PERSON B</b>
                    </p>
                    {% if "3PP" in player.treatment or "3PR" in player.treatment or "3PC" in player.treatment %}
                        <p>
                            <b style="position: absolute; top: 85%; left:40%;">PERSON C</b>
                        </p>
                    {% endif %}
                {% endif %}

                <span class='coinstack coinstackD' data-index="{{ TP_norm_decision.index }}"></span>
                <div class="coin-count-labelD"
                     style="{% if '2PP' in player.treatment %}top: 55%;{% endif %}"
                     id="countD" data-index="{{ TP_norm_decision.index }}"></div>

                <span class='coinstack coinstackR' data-index="{{ TP_norm_decision.index }}"></span>
                <div class="coin-count-labelR"
                     style="{% if '2PP' in player.treatment %}top: 20%;{% endif %}"
                     id="countR" data-index="{{ TP_norm_decision.index }}"></div>


<!--                {% if "punish" in player.treatment %}-->
<!--                    <span class='coinstack coinstackDDes'-->
<!--                      style="{% if '2PP' in player.treatment %}top: 55%;{% endif %}"-->
<!--                          data-index="{{ TP_norm_decision.index }}"></span>-->
<!--                    <div class="coin-count-labelDDes" id="countDDes" data-index="{{ TP_norm_decision.index }}"></div>-->
<!--                {% endif %}-->

<!--                {% if "reward" in player.treatment %}-->
<!--                    <span class='coinstack coinstackTP3PR' data-index="{{ TP_norm_decision.index }}"></span>-->
<!--                    <div class="coin-count-labelTP3PR" id="countTP3PR" data-index="{{ TP_norm_decision.index }}"></div>-->
<!--                {% endif %}-->

<!--                {% if "comp" in player.treatment %}-->
<!--                    <span class='coinstack coinstackTP3PC' data-index="{{ TP_norm_decision.index }}"></span>-->
<!--                    <div class="coin-count-labelTP3PC" id="countTP3PC" data-index="{{ TP_norm_decision.index }}"></div>-->
<!--                {% endif %}-->


                {% if "3PP" in player.treatment or "3PC" in player.treatment %}
                    <img src="/static/global/minus_button2.png" alt="-" style="position: absolute; width: 1.8vw; top: 55%; left: 12%;">
                {% endif %}

                {% if "3PR" in player.treatment %}
                    <img src="/static/global/plus_button.png" alt="+" style="position: absolute; width: 1.8vw; top: 55%; left: 15%;">
                {% endif %}

                {% if "3PC" in player.treatment %}
                    <img src="/static/global/plus_button.png" alt="+" style="position: absolute; width: 1.8vw; top: 55%; left: 84%;">
                {% endif %}

                {% if "2PP" in player.treatment %}
                    <img src="/static/global/minus_button2.png" alt="-" style="position: absolute; width: 1.8vw; top: -8%; left: 46%;">
                    <img src="/static/global/punish arrow orange.png" alt="-" style="position: absolute; width: 8vw; top: 3%; left: 28%;">

                {% endif %}

            </div>

            {% if "IN" in player.treatment or "OUT" in player.treatment%}
                <p style="font-size: 14px;">
                    Person A lives in <b >{{ dic_identity_country }}</b> and Person B lives in <b >{{ recip_identity_country }}</b>.
                </p>
            {% endif %}

            {% if "country" in player.treatment %}
                <p style="font-size: 14px;">
                    Person A lives in <b style="color: red; ">{{ dic_identity_country }}</b> and Person B lives in <b style="color: red; ">{{ recip_identity_country }}</b>.
                </p>
            {% endif %}


            <p style="font-size: 14px;">
                Person A gave <b> {{TP_norm_decision.receiver }} point(s)</b> to Person B
                and kept <b> {{TP_norm_decision.dictator_keeps }} point(s)</b> for themselves.
            </p>

            <p>
                <strong>How socially appropriate is it for {{treatment_text_action_person}} to
                <b style="color: red;">{{ treatment_text_action }} points</b> {{ treatment_text_receiver }}?</strong>
            </p>

            <div class='numbers'>
                <div class="number-row" data-index="{{ TP_norm_decision.index }}" data-input="selected-norm-{{ TP_norm_decision.index }}">
                    <div class="norm" data-value="0" data-index="{{ TP_norm_decision.index }}">very socially<br>inappropriate</div>
                    <div class="norm" data-value="1" data-index="{{ TP_norm_decision.index }}">socially<br>inappropriate</div>
                    <div class="norm" data-value="2" data-index="{{ TP_norm_decision.index }}">slightly socially<br>inappropriate</div>
                    <div class="norm" data-value="3" data-index="{{ TP_norm_decision.index }}">slightly socially<br>appropriate</div>
                    <div class="norm" data-value="4" data-index="{{ TP_norm_decision.index }}">socially<br>appropriate</div>
                    <div class="norm" data-value="5" data-index="{{ TP_norm_decision.index }}">very socially<br>appropriate</div>
                </div>
            </div>

            {% if "punish" in player.treatment or "reward" in player.treatment %}
            <br>

             <p style="text-align: center; ">
                <b >AND</b>
            </p>

            <p>
                <strong>How socially appropriate is it for {{treatment_text_action_person}} to
                <b style="color: red;"> <u>NOT</u> {{ treatment_text_action }} points</b> {{ treatment_text_receiver }}?</strong>
            </p>

            <div class='numbers'>
                <div class="number-row" data-index="{{ TP_norm_decision.index }}" data-input="selected-neg-norm-{{ TP_norm_decision.index }}">
                    <div class="neg-norm" data-value="0" data-index="{{ TP_norm_decision.index }}">very socially<br>inappropriate</div>
                    <div class="neg-norm" data-value="1" data-index="{{ TP_norm_decision.index }}">socially<br>inappropriate</div>
                    <div class="neg-norm" data-value="2" data-index="{{ TP_norm_decision.index }}">slightly socially<br>inappropriate</div>
                    <div class="neg-norm" data-value="3" data-index="{{ TP_norm_decision.index }}">slightly socially<br>appropriate</div>
                    <div class="neg-norm" data-value="4" data-index="{{ TP_norm_decision.index }}">socially<br>appropriate</div>
                    <div class="neg-norm" data-value="5" data-index="{{ TP_norm_decision.index }}">very socially<br>appropriate</div>
                </div>
            </div>
            {% endif %}
        <hr>
        <br>
        </div>
        {% endfor %}


        {% else %}

<!--        {% if role_switch_true == True %}-->

<!--            {% if "2PP" in player.treatment %}-->

<!--            <p style="text-align: center; ">-->
<!--                <b style="color: red;">Role switch! You are now Person B!</b>-->

<!--                <br>-->
<!--                <br>-->
<!--                <br>-->

<!--            </p>-->

<!--            {% else %}-->

<!--            <p style="text-align: center;">-->
<!--                <b style="color: red;">Role switch! You are now Person C!</b>-->
<!--            </p>-->

<!--            {% endif %}-->

<!--        {% endif %}-->

        {% if "2PP" in player.treatment %}

            <p style="text-align: center; ">
                <b style="color: red; ">You are Person B!</b>
            </p>

        <br>
        {% endif %}

        {% if "3PP" in player.treatment or "3PR" in player.treatment or "3PC" in player.treatment %}
            <p style="text-align: center; ">
                <b style="color: red;">You are Person C!</b>
            </p>

            {% if "3PC" in player.treatment %}
                <p style="font-size: 14px;"> Keep in mind that you can <u>either</u> <b>remove points</b> from <b>Person A <u>or</u> give points</b> to <b>Person B</b>. </p> <br>
            {% endif %}

        {% endif %}

        {% if "2PP" in player.treatment or "3PP" in player.treatment %}

            <b> Now, you decide as Person C how many points to remove from Person A.</b> <br>

            <p> Below are three different possible decisions of Person A. </p> <br>

        {% endif %}

        {% for TP_decision in TP_decisions %}
        <div class='responsive-div'>
            <div class="container {% if '2PP' in player.treatment %}short-container{% endif %}" data-index="{{ TP_decision.index }}">

                {% if dic_identity != "baseline"%}
                    <img src="" style='width:50%; position:absolute; right:17.5vw' class='dictatorCountry'>
                    <img src="" style='width:50%; position:absolute; left:17.8vw' class='receiverCountry'>

                    <img src="" style='width:50%; position:absolute; top:7vw; right:22vw' class='dictatorCountryMap'>
                    <img src="" style='width:50%; position:absolute; top:7vw; left:22vw' class='receiverCountryMap'>
                {% endif %}

                <img src="/static/{{ image }}" style="width:27vw; position:absolute; left:-25%; top:3vw">

                {% if "0DG" in player.treatment or "2PP" in player.treatment %}
                    <p>
                        <b style="position: absolute; top: 60%; left:-25%;">PERSON A</b>
                    </p>
                    <p>
                        <b style="position: absolute; top: 60%; right:-27%;">PERSON B</b>
                    </p>
                {% else %}
                    <p>
                        <b style="position: absolute; top: 36%; left:-25%;">PERSON A</b>
                    </p>
                    <p>
                        <b style="position: absolute; top: 36%; right:-27%;">PERSON B</b>
                    </p>
                    {% if "3PP" in player.treatment or "3PR" in player.treatment or "3PC" in player.treatment %}
                        <p>
                            <b style="position: absolute; top: 85%; left:40%;">PERSON C</b>
                        </p>
                    {% endif %}
                {% endif %}

                <span class='coinstack coinstackD' data-index="{{ TP_decision.index }}"></span>
                <div class="coin-count-labelD"
                     style="{% if '2PP' in player.treatment %}top: 55%;{% endif %}"
                     id="countD" data-index="{{ TP_decision.index }}"></div>

                <span class='coinstack coinstackR' data-index="{{ TP_decision.index }}"></span>
                <div class="coin-count-labelR"
                     style="{% if '2PP' in player.treatment %}top: 20%;{% endif %}"
                     id="countR" data-index="{{ TP_decision.index }}"></div>


                {% if "3PP" in player.treatment or "3PC" in player.treatment %}
                    <span class='coinstack coinstackDDes' data-index="{{ TP_decision.index }}"></span>
                    <div class="coin-count-labelDDes" id="countDDes" data-index="{{ TP_decision.index }}"></div>
                {% endif %}

                {% if "2PP" in player.treatment %}
                    <span class='coinstack coinstackDDes2PP' data-index="{{ TP_decision.index }}"></span>
                    <div class="coin-count-labelDDes2PP" id="countDDes2PP" data-index="{{ TP_decision.index }}"></div>
                {% endif %}

                {% if "reward" in player.treatment %}
                    <span class='coinstack coinstackTP3PR' data-index="{{ TP_decision.index }}"></span>
                    <div class="coin-count-labelTP3PR" id="countTP3PR" data-index="{{ TP_decision.index }}"></div>
                {% endif %}

                {% if "comp" in player.treatment %}
                    <span class='coinstack coinstackTP3PC' data-index="{{ TP_decision.index }}"></span>
                    <div class="coin-count-labelTP3PC" id="countTP3PC" data-index="{{ TP_decision.index }}"></div>
                {% endif %}

                {% if "3PP" in player.treatment or "3PC" in player.treatment %}
                    <img src="/static/global/minus_button2.png" alt="-" style="position: absolute; width: 1.8vw; top: 55%; left: 12%;">
                {% endif %}

                {% if "3PR" in player.treatment %}
                    <img src="/static/global/plus_button.png" alt="+" style="position: absolute; width: 1.8vw; top: 55%; left: 15%;">
                {% endif %}

                {% if "3PC" in player.treatment %}
                    <img src="/static/global/plus_button.png" alt="+" style="position: absolute; width: 1.8vw; top: 55%; left: 84%;">
                {% endif %}

                {% if "2PP" in player.treatment %}
                    <img src="/static/global/minus_button2.png" alt="-" style="position: absolute; width: 1.8vw; top: -8%; left: 46%;">
                    <img src="/static/global/punish arrow orange.png" alt="-" style="position: absolute; width: 8vw; top: 3%; left: 28%;">
                    <p>
                        <b style="color: red; font-size: 24px; position: absolute; top: 43%; left:101%;">YOU</b>
                    </p>
                {% else %}
                    <p>
                        <b style="color: red; font-size: 24px; position: absolute; top: 75%; left:46%;">YOU</b>
                    </p>
                {% endif %}

            </div>

                {% if "IN" in player.treatment or "OUT" in player.treatment%}
                    <p style="font-size: 14px;"> Person A lives in <b >{{ dic_identity_country }}</b> and Person B lives in <b >{{ recip_identity_country }}</b>. </p>
                {% endif %}

                {% if "country" in player.treatment %}
                    <p style="font-size: 14px;">
                        Person A lives in <b style="color: red; ">{{ dic_identity_country }}</b> and Person B lives in <b style="color: red; ">{{ recip_identity_country }}</b>.
                    </p>
                {% endif %}

                <p style="font-size: 14px;"> Person A gave <b> {{TP_decision.receiver }} point(s)</b> to {{treatment_text_action_person2}} and kept <b> {{TP_decision.dictator_keeps }} point(s) </b> for themselves. </p>

                <div class='numbers'>
                    <p>  <strong>As {{treatment_text_action_person}}, how many points do you <b style="color: red;"> {{ treatment_text_action }} </b>  {{ treatment_text_receiver }}? </strong> </p>

                    <div class="number-row" data-index="{{ TP_decision.index }}" data-row="punish" data-input="selected-number-{{ TP_decision.index }}">
                        {{ for num in TP_points }}
                        <div class="number" data-value="{{ num }}" data-row="punish" data-index="{{ TP_decision.index }}">{{ num }}</div>
                        {{ endfor }}
                    </div>
                    {% if "3PC" in player.treatment%}
                    <br>

                    <p style="text-align: center; ">
                        <b style="color: red; ">OR</b>
                    </p>

                    <p> <strong>How many points do you <b style="color: red;"> {{ treatment_text_action_comp }} </b>  {{ treatment_text_receiver_comp }}? </strong> </p>

                    <div class="number-row-comp" data-index="{{ TP_decision.index }}" data-row="compensate" data-input="selected-number-{{ TP_decision.index }}">
                        {{ for num in TP_points }}
                        <div class="number" data-value="{{ num }}" data-row="compensate" data-index="{{ TP_decision.index }}">{{ num }}</div>
                        {{ endfor }}
                    </div>
                    {% endif %}
                </div>

            <div data-index="{{ TP_decision.index }}">
                <p style="font-size: 14px;"> This costs you <span class="TP-cost-display" data-index="{{ TP_decision.index }}"></span> point(s).
                </p>
            </div>

            <hr>
            <br>
        </div>
        {% endfor %}

        {% endif %}

        <br>
       <div style="display: flex; justify-content: flex-end">
        <button style="color: #fff;
                       background-color: #007bff;
                       border: 1px solid #007bff;
                       font-size: 1rem;
                       border-radius: 0.25rem;
                       padding: 4px 12px;" type="button" id="submit-button">
            Next
        </button>
    </div>

    {% if "2PP" in player.treatment or "3PP" in player.treatment or "3PR" in player.treatment or "3PC" in player.treatment %}

    <br>

            <div class="reminder">

                    <p style="text-align: center; ">
                        <b>Reminder</b>
                    </p>

                    <p> There are <strong>two stages</strong>. </p>

                    <p> <b> Stage 1: </b> </p>

                    <div style="margin-left: 5%;">

                        <p><strong>Person A</strong> receives 12 points.<br>
                                <strong>Person B</strong> receives 0 points.</p>

                        <p><strong>Person A</strong> decides how many of the 12 points to give to Person B.</p>

                    </div>

                    <p> <b>Stage 2:</b> </p>

                    {% if "2PP" in player.treatment %}

                        <div style="margin-left: 5%;">

                            <p> <b>Person B</b> is able to <strong>remove points</strong> from <strong>Person A</strong>. </p>

                            <p>Person A and Person B both receive 4 points in Stage 2. Only Person B can use these points to remove points from Person A. Only Person A's remaining points from Stage 1 can be removed. Removed points are eliminated and cannot be used by anyone. Removing <b>3 points</b> from Person A will cost Person B <b>1 point</b> (cost of removing 1 point: 0.33 points).</p>
                        </div>

                    {% endif %}

                    {% if "3PP" in player.treatment %}

                        <div style="margin-left: 5%;">

                            <p> <b>Person C</b> is able to <strong>remove points</strong> from <strong>Person A</strong>. </p>

                            <p>Person C receives 4 points in Stage 2 and can use these points to remove points from Person A. Removed points are eliminated and cannot be used by anyone. Removing <b>3 points</b> from Person A will cost Person C <b>1 point</b> (cost of removing 1 point: 0.33 points).</p>
                        </div>

                    {% endif %}

                    {% if "3PR" in player.treatment %}

                        <div style="margin-left: 5%;">

                            <p> <b>Person C</b> is able to <strong>give points</strong> to <strong>Person A</strong>. </p>

                            <p>Person C receives 4 points in Stage 2 and can use these points to give points to Person A. Giving <b>3 points</b> to Person A will cost Person C <b>1 point</b> (cost of giving 1 point: 0.33 points).</p>
                        </div>

                    {% endif %}

                    {% if "3PC" in player.treatment %}

                        <div style="margin-left: 5%;">

                            <p> <b>Person C</b> is able to <u>either</u> <b>remove points</b> from <b>Person A <u>or</u> give points</b> to <b>Person B</b>. Person C <u>cannot</u> both give points and remove points, they must choose <u>one</u> action.</p>

                            <p>Person C receives 4 points in Stage 2 and can use these points to remove or give points. Removed points are eliminated and cannot be used by anyone. Removing <b>3 points</b> from Person A OR giving <b>3 points</b> to Person B will cost Person C <b>1 point</b> (cost of removing OR giving 1 point: 0.33 points).</p>
                        </div>

                    {% endif %}

                </div>
        {% endif %}



    </form>

</body>
</html>



{{ endblock }}
