{{ block title }}

{{ endblock }}
{{ block content }}


<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1.0">


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

/////////// global variables

    let TP_decisions_stored = [0, 0, 0, 0]; // Array to store selected values for each row
    //console.log(`Punishment values: ${TP_decisions_stored}`);

    var current_treatment = "{{ treatment }}";
    //console.log("Current treatment:", current_treatment );

    const TP_points = {{ C.TP_points }}; // punishment points
    const TP_eff = {{ C.TP_effectiveness }}; // punishment or reward or victim compensation effectiveness

    const TP_decisions = {{ TP_decisions | safe }};
    //console.log('Decisions:', {{ TP_decisions | safe }});



/////////// All the functions related to hovering and coinstacks/labels updating had to be moved out of the large parent function.
// I do not know why but it works now

    // function to update the coin stack
    function updateCoinStack(count, index) {

        const TP_decision = TP_decisions.find((d) => d.index === parseInt(index, 10));

        TPupdate = TP_points - count
        dictator_recipient_TPeffectUpdate = count * TP_eff

        Dupdate = TP_decision.dictator_keeps - (count * TP_eff)

        if (Dupdate < 0 && (current_treatment.includes("punish") || current_treatment.includes("3PP country") )) { // if Dupdate is less than 0 & we are in punishment condition
            dictator_recipient_TPeffectUpdate = dictator_recipient_TPeffectUpdate + Dupdate // Set dictator_recipient_TPeffectUpdate to max endowment (not more)
            Dupdate = 0; // Set Dupdate to 0 if it's less than 0
    }

        if (current_treatment.includes("reward") || current_treatment.includes("comp")) { // leave dictator coins if 3PR or 3PC
            Dupdate = TP_decision.dictator_keeps
    }

        // Clear existing stacks
        $(`.coinstackTP[data-index="${index}"]`).empty();
        //console.log('Cleared coinstackTP for index:', index);
        $(`.coinstackD[data-index="${index}"]`).empty();
        //console.log('Cleared coinstackD for index:', index);
        $(`.coinstackDDes[data-index="${index}"]`).empty();
        //console.log('Cleared coinstackDDes for index:', index);
        $(`.coinstackTP2PP[data-index="${index}"]`).empty();
        $(`.coinstackTP3PR[data-index="${index}"]`).empty();
        $(`.coinstackTP3PC[data-index="${index}"]`).empty();

        // Add the specified number of coins
        for (let i = 0; i < TPupdate; i++) {
            $(`.coinstackTP[data-index="${index}"]`).append('<div class="coinown" style="left:75%;"></div>');
        }

        for (let i = 0; i < Dupdate; i++) {
            $(`.coinstackD[data-index="${index}"]`).append('<div class="coin" style="left:19%;"></div>');
        }

        for (let i = 0; i < dictator_recipient_TPeffectUpdate; i++) {
            $(`.coinstackDDes[data-index="${index}"]`).append('<div class="coin_destroyed" style="left:19%;"></div>');
        }

        // Update other stacks for subconditions: 2PP, 2PR, 3PC
        for (let i = 0; i < TPupdate; i++) {
            $(`.coinstackTP2PP[data-index="${index}"]`).append('<div class="coinown2PP" style="left:83%;"></div>');
        }

        for (let i = 0; i < dictator_recipient_TPeffectUpdate; i++) {
            $(`.coinstackTP3PR[data-index="${index}"]`).append('<div class="coinown3PR" style="left:7%;"></div>');
        }

        for (let i = 0; i < dictator_recipient_TPeffectUpdate; i++) {
            $(`.coinstackTP3PC[data-index="${index}"]`).append('<div class="coinown3PC" style="left:102%;"></div>');
        }

        // Update the number labels
        $(`#countTP[data-index="${index}"]`).text(`${TPupdate}`);
        //console.log('coin number for index:', index);
        $(`#countD[data-index="${index}"]`).text(`${Dupdate}`);
        $(`#countDDes[data-index="${index}"]`).text(`${dictator_recipient_TPeffectUpdate}`);
        $(`#countTP2PP[data-index="${index}"]`).text(`${TPupdate}`);
        $(`#countTP3PR[data-index="${index}"]`).text(`${dictator_recipient_TPeffectUpdate}`);
        $(`#countTP3PC[data-index="${index}"]`).text(`${dictator_recipient_TPeffectUpdate}`);

        //Debugging
        //console.log('updateCoinStack called with:', { count, index });
    }

    if (!current_treatment.includes("norm") ) { // only in TP conditions

        // Hover function calling updateCoinStack
        $(document).on('mouseenter', '.number', function () {
            const value = $(this).data('value'); // Get the number value
            const index = $(this).data('index'); // Get the index of the element
            console.log('Hover triggered. Value:', value, 'Index:', index);
            updateCoinStack(value, index);
        });

        // Function to restore the clicked or initial state of the row
        function restoreRowState(index) {
            const clickedValue = TP_decisions_stored[index - 1];
            if (clickedValue > 0) {
                updateCoinStack(clickedValue, index); // Restore to the clicked state
            } else {
                const TP_decision = TP_decisions.find((d) => d.index === parseInt(index, 10));
                updateCoinStack(0, index); // Restore to the initial state
            }
            //console.log(`Restored row ${index} to ${clickedValue > 0 ? "clicked state" : "initial state"}`);
        }

        $(document).on('mouseleave', '.number-row', function () {
            const index = $(this).data('index');
            restoreRowState(index);
        });
    }

////////////// function for displaying the task, numbers, and labels and managing the click event
$(document).ready(function () {

    dictator_recipient_TPeffect = 0 // dictator or recipient points that are destroyed by punishment or added by reward/compensation

    // country pictures from https://github.com/irixapps/World-Flags/tree/master
    // naming convention: https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2

    receiverCountry = "{{ recip_identity }}"
    dictatorCountry = "{{ dic_identity }}"

    role_switch_true = "{{ role_switch_true }}"

    /////////////// script

    // get flags
    $('.receiverCountry').attr('src', '/static/global/flags/' + receiverCountry +'.png');
    $('.dictatorCountry').attr('src', '/static/global/flags/' + dictatorCountry +'.png');

    // get maps
    $('.receiverCountryMap').attr('src', '/static/global/worldmap/' + receiverCountry +'_map.png');
    $('.dictatorCountryMap').attr('src', '/static/global/worldmap/' + dictatorCountry +'_map.png');

    // Norm variables; Will need to be changed for multiple decisions
    if (current_treatment.includes("norm") ) { // in norm condition
        total_endowment = {{C.total_endowment }}
        receiver = {{ C.norm_strategy_dic_gives_binary }} // The receiver gets however much the dictator gives
        TP_points_assigned = {{ C.norm_strategy_punish_norm }} // punishment points assigned by punisher
        TP = TP_points - TP_points_assigned // punishment points
        dictator_recipient_TPeffect = TP_points_assigned * TP_eff
        dictator_kept = total_endowment - receiver
        dictator = dictator_kept - dictator_recipient_TPeffect
        document.getElementById("dictator_recipient_TPeffect").textContent = dictator_recipient_TPeffect;
    }

    // Initialize coin stacks for each TP decision
    TP_decisions.forEach((TP_decision) => {
        const index = TP_decision.index;
        const dictatorKeeps = TP_decision.dictator_keeps;
        const receiverGets = TP_decision.receiver;

        // Fill initial coin stacks
        // dictator stack
        for (let i = 0; i < dictatorKeeps; i++) {
            $(`.coinstackD[data-index="${index}"]`).append('<div class="coin" style="left:19%;"></div>');
        }
        // red stack (destructed coins)
        for (let i = 0; i < dictator_recipient_TPeffect; i++) {
            $(`.coinstackDDes[data-index="${index}"]`).append('<div class="coinown" style="left:75%;"></div>></div>');
        }
        // punisher stack
        for (let i = 0; i < TP_points; i++) {
            $(`.coinstackTP[data-index="${index}"]`).append('<div class="coinown" style="left:75%;"></div>></div>');
        }
        // receiver stack
        for (let i = 0; i < receiverGets; i++) {
            $(`.coinstackR[data-index="${index}"]`).append('<div class="coin" style="left:83%;"></div>');
        }

        // Extra stacks in different locations
        // punisher in 2PP punisher stack
        for (let i = 0; i < TP_points; i++) {
            $(`.coinstackTP2PP[data-index="${index}"]`).append('<div class="coinown2PP" style="left:83%;"></div>');
        }
        // DG reward in 3PR
        for (let i = 0; i < dictator_recipient_TPeffect; i++) {
            $(`.coinstackTP3PR[data-index="${index}"]`).append('<div class="coinown3PR" style="left:7%;"></div>');
        }
        // recipient compensation in 3PC
        for (let i = 0; i < dictator_recipient_TPeffect; i++) {
            $(`.coinstackTP3PC[data-index="${index}"]`).append('<div class="coinown3PC" style="left:102%;"></div>');
        }

        // Initialize number labels
        $('#countTP[data-index="' + index + '"]').text(`${TP_points}`);
        $('#countD[data-index="' + index + '"]').text(`${dictatorKeeps}`);
        $('#countR[data-index="' + index + '"]').text(`${receiverGets}`);
        $('#countTP2PP[data-index="' + index + '"]').text(`${TP_points}`);
        // You can also initialize other labels like countDDes, countTP3PR, etc. if needed
        // $('#countDDes[data-index="' + index + '"]').text(`${dictator_recipient_TPeffect}`);
        // $('#countTP3PR[data-index="' + index + '"]').text(`${dictator_recipient_TPeffect}`);
        // $('#countTP3PC[data-index="' + index + '"]').text(`${dictator_recipient_TPeffect}`);
    });


    // Initialize coin stacks for TP NORM decisions, and then collect responses
    if (current_treatment.includes("norm") ) { // in norm condition

        for (let i = 0; i < dictator; i++) {
            $('.coinstackD').append('<div class="coin" style="left:19%;"></div>');
        }
        for (let i = 0; i < dictator_recipient_TPeffect; i++) {
            $('.coinstackDDes').append('<div class="coin_destroyed" style="left:19%;"></div>');
        }
        for (let i = 0; i < TP; i++) {
            $('.coinstackTP').append('<div class="coinown" style="left:75%;"></div>');
        }
        for (let i = 0; i < receiver; i++) {
            $('.coinstackR').append('<div class="coin" style="left:83%;"></div>');
        }

        // Make another coin stack for punisher in 2PP: different location
        for (let i = 0; i < TP; i++) {
            $('.coinstackTP2PP').append('<div class="coinown2PP" style="left:83%;"></div>');
        }
        // Make another coin stack for DG reward in 3PR: different location
        for (let i = 0; i < dictator_recipient_TPeffect; i++) {
            $('.coinstackTP3PR').append('<div class="coinown3PR" style="left:7%;"></div>');
        }
        // Make another coin stack for recipient compensation in 3PC: different location
        for (let i = 0; i < dictator_recipient_TPeffect; i++) {
            $('.coinstackTP3PC').append('<div class="coinown3PC" style="left:102%;"></div>');
        }

        // Initialize the number labels
        $('#countTP').text(`${TP}`);
        $('#countD').text(`${dictator}`);
        $('#countDDes').text(`${dictator_recipient_TPeffect}`);
        $('#countR').text(`${receiver}`);
        $('#countTP2PP').text(`${TP}`);
        $('#countTP3PR').text(`${dictator_recipient_TPeffect}`);
        $('#countTP3PC').text(`${dictator_recipient_TPeffect}`);

        // Collect responses
        $('.norm').on('click', function () {
            // Remove 'selected' class from all buttons
            $('.norm').removeClass('selected');

            // Add 'selected' class to the clicked button
            $(this).addClass('selected');

            // Get the value of the clicked button
            const value = $(this).data('value');

            // Update the hidden input field
            $('#selected-TP_norm_decision1').val(value);

            // // Update the coin stack
            // updateCoinStack(value);

            dictator = value

            console.log("dictator", dictator)
    });

    }

    function deactivateNumbers(numbersToDisable, index) {
        numbersToDisable.forEach(num => {
            $('.number[data-value="' + num + '"][data-index="' + index + '"]').addClass('disabled');
        });
    }

    if (!current_treatment.includes("norm") ) { // only in TP conditions
        // deactive punishment that would generate negative values
        let numbersToDisable = [];
        TP_decisions.forEach(TP_decision => {
            DPpossible = Math.ceil(TP_decision.dictator_keeps / 3);
            for (let i = DPpossible + 1; i <= TP_points; i++) {
                numbersToDisable.push(i);
            }

            //Deactivate numbers only in punishment conditions
            //if (current_treatment == "3PP punish" || current_treatment == "2PP punish") { // leave dictator coins if 3PR or 3PC
            if (current_treatment.includes("punish") || current_treatment.includes("3PP country")) {
                deactivateNumbers(numbersToDisable, TP_decision.index);
            }
        });

        $('.number').on('click', function () {
            // Remove 'selected' class from all buttons
            $(this).closest('.number-row').find('.number').removeClass('selected');

            // Add 'selected' class to the clicked button
            $(this).addClass('selected');

            // Get the value of the clicked button
            const value = $(this).data('value');
            const index = $(this).data('index');

            // Update the corresponding punishment value in the array
            TP_decisions_stored[index - 1] = value;

            // Update the hidden input field
            $(`#selected-number-${index}`).val(value);

            // Update the coin stack
            updateCoinStack(value, index);


            // Debugging
            //console.log('Index:', index);
            console.log('Value:', value);
            //console.log('TP Decisions:', TP_decisions);
            //console.log(`Punishment values: ${TP_decisions_stored}`);
        });
    }
        // Submit button click handler
        $('#submit-button').on('click', function () {
            // Submit the form
            $('form').submit();
        });

});
</script>


<style>

    body {
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin-top: 4vw;
        background-color: #f4f4f4;
    }

    .number-row {
        justify-content: center;
        display: flex;
        margin-top:3vw;
        /*gap: 1vw; !* Space between numbers scales with viewport width *!*/
        gap: 0.5vw; /* Space between numbers scales with viewport width */
        flex-wrap: wrap; /* Optional: allows wrapping if buttons exceed container width */
        align-items: center; /* Ensures proper vertical alignment */
    }

    .number {
        width: 3vw; /* Width scales with viewport width */
        height: 3vw; /* Height scales with viewport width */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5vw; /* Font size scales with viewport width */
        background-color: #e0e0e0;
        border: 2px solid #000000;
        border-radius: 10%; /* Slightly rounded corners */
        cursor: pointer;
        font-family: Arial, Helvetica, sans-serif;
        transition: background-color 0.3s ease;
    }

    .norm {
        width: 6vw; /* Width scales with viewport width */
        height: 5vw; /* Height scales with viewport width */
        flex-direction: column;
        text-align: center; /* Center-aligns the text */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.9vw; /* Font size scales with viewport width */
        background-color: #e0e0e0;
        border: 2px solid #000000;
        border-radius: 10%; /* Slightly rounded corners */
        cursor: pointer;
        font-family: Arial, Helvetica, sans-serif;
        transition: background-color 0.3s ease;
    }

    .number:hover {
        background-color: #ffcc00; /* Change background color on hover */
    }

    .number:active {
        background-color: #ffa500; /* Change background color on click */
    }

    .number.selected {
             background-color: #ffa500; /* Permanent color when clicked */
    }

    .number.disabled {
        background-color: #F3F3F3; /* Grey color for disabled buttons */
        border: 2px solid #d3d3d3;
        color:#d3d3d3;
        cursor: not-allowed;
        pointer-events: none; /* Disable interactions */
    }

    .norm:hover {
        background-color: #ffcc00; /* Change background color on hover */
    }

    .norm:active {
        background-color: #ffa500; /* Change background color on click */
    }

    .norm.selected {
             background-color: #ffa500; /* Permanent color when clicked */
    }

    .norm.disabled {
        background-color: #F3F3F3; /* Grey color for disabled buttons */
        border: 2px solid #d3d3d3;
        color:#d3d3d3;
        cursor: not-allowed;
        pointer-events: none; /* Disable interactions */
    }

    .responsive-div {
      width: 90%; /* Default width */
      transform-origin: top left; /* Ensure scaling starts from top-left */
      transform: scale(1); /* Default scale */
      transition: transform 0.3s ease; /* Smooth scaling */
      /*border:1px solid black;*/
      margin-left:auto;
      margin-right:auto;
    }

    .container {
        width:45%;
        height:25vw;
        margin-left:auto;
        margin-right:auto;
        border:0px solid black;
        position:relative;
    }

    @media (max-width: 1200px) {
      .responsive-div {
        transform: scale(1.0); /* Scale to 80% for smaller screens */
      }
      .container {
          margin-left:10vw;
      }
      .numbers {
          position:absolute;
          transform: scale(0.95);
          left:6vw;
      }
    }

    @media (max-width: 800px) {
      .responsive-div {
        transform: scale(2); /* Scale to 60% for even smaller screens */
      }
      .container {
          margin-left:1vw;
      }
      .numbers {
          position:absolute;
          transform: scale(0.95);
          left:-3.2vw;
      }
      .number {
          font-size:2vw;
          border-width:1px;
      }
    }

    .coin-stack {
        position: absolute;
        width: 5vw; /* The stack width adjusts to 20% of the viewport width */
        max-width: 100px; /* Ensure coins don't get too big */
    }

    .coin {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coin_destroyed {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background-color: rgba(255, 0, 0, 0.15); /* Semi-transparent red (0.5 is 50% transparency) */
        /*background: linear-gradient(145deg, #ffd700, #e6c200);*/
        /*border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        /*box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);*/
        position: absolute;
        transform: translateX(-50%);
}

    .coinown {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        /*border: 0.1vw solid #FFFFFF; !* Border size scales with the coin size *!*/
        border: 0.1vw solid darkred; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coinown2PP {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        /*border: 0.1vw solid #FFFFFF; !* Border size scales with the coin size *!*/
        border: 0.1vw solid darkred; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coinown3PR {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coinown3PC {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coin-count-labelD {
    font-size: 1.2rem;
    color: #333; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 30%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 32%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelDDes {
    font-size: 1.2rem;
    color: rgba(255, 0, 0, 0.15); /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 30%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 0%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelR {
    font-size: 1.2rem;
    color: #333; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 73%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 32%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelTP {
    font-size: 1.2rem;
    color: darkred; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 85%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 80%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelTP2PP {
    font-size: 1.2rem;
    color: darkred; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 73%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 8%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelTP3PR {
    font-size: 1.2rem;
    color: #333; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: -4%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 56%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin-count-labelTP3PC {
    font-size: 1.2rem;
    color: #333; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 113%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 56%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}

    .coin:nth-child(12)  { top: 6.0vw; }
    .coin:nth-child(11)  { top: 6.3vw; }
    .coin:nth-child(10)  { top: 6.6vw; }
    .coin:nth-child(9)   { top: 6.9vw; }
    .coin:nth-child(8)   { top: 7.2vw; }
    .coin:nth-child(7)   { top: 7.5vw; }
    .coin:nth-child(6)   { top: 7.8vw; }
    .coin:nth-child(5)   { top: 8.1vw; }
    .coin:nth-child(4)   { top: 8.4vw; }
    .coin:nth-child(3)   { top: 8.7vw; }
    .coin:nth-child(2)   { top: 9.0vw; }
    .coin:nth-child(1)   { top: 9.3vw; }

    .coinown:nth-child(10)  { top: 18.8vw; }
    .coinown:nth-child(9)   { top: 19.1vw; }
    .coinown:nth-child(8)   { top: 19.4vw; }
    .coinown:nth-child(7)   { top: 19.7vw; }
    .coinown:nth-child(6)   { top: 20.0vw; }
    .coinown:nth-child(5)   { top: 20.3vw; }
    .coinown:nth-child(4)   { top: 20.6vw; }
    .coinown:nth-child(3)   { top: 20.9vw; }
    .coinown:nth-child(2)   { top: 21.2vw; }
    .coinown:nth-child(1)   { top: 21.5vw; }

    .coinown2PP:nth-child(10)  { top: 0.6vw; }
    .coinown2PP:nth-child(9)   { top: 0.9vw; }
    .coinown2PP:nth-child(8)   { top: 1.2vw; }
    .coinown2PP:nth-child(7)   { top: 1.5vw; }
    .coinown2PP:nth-child(6)   { top: 1.8vw; }
    .coinown2PP:nth-child(5)   { top: 2.1vw; }
    .coinown2PP:nth-child(4)   { top: 2.4vw; }
    .coinown2PP:nth-child(3)   { top: 2.7vw; }
    .coinown2PP:nth-child(2)   { top: 3.0vw; }
    .coinown2PP:nth-child(1)   { top: 3.3vw; }


    .coinown3PR:nth-child(1)  { top: 15.8vw; }
.coinown3PR:nth-child(2)  { top: 15.5vw; }
.coinown3PR:nth-child(3)  { top: 15.2vw; }
.coinown3PR:nth-child(4)   { top: 14.9vw; }
.coinown3PR:nth-child(5)   { top: 14.6vw; }
.coinown3PR:nth-child(6)   { top: 14.3vw; }
.coinown3PR:nth-child(7)   { top: 14.0vw; }
.coinown3PR:nth-child(8)   { top: 13.7vw; }
.coinown3PR:nth-child(9)   { top: 13.4vw; }
.coinown3PR:nth-child(10)   { top: 13.1vw; }
.coinown3PR:nth-child(11)   { top: 12.8vw; }
.coinown3PR:nth-child(12)   { top: 12.5vw; }

.coinown3PC:nth-child(1)  { top: 15.8vw; }
.coinown3PC:nth-child(2)  { top: 15.5vw; }
.coinown3PC:nth-child(3)  { top: 15.2vw; }
.coinown3PC:nth-child(4)   { top: 14.9vw; }
.coinown3PC:nth-child(5)   { top: 14.6vw; }
.coinown3PC:nth-child(6)   { top: 14.3vw; }
.coinown3PC:nth-child(7)   { top: 14.0vw; }
.coinown3PC:nth-child(8)   { top: 13.7vw; }
.coinown3PC:nth-child(9)   { top: 13.4vw; }
.coinown3PC:nth-child(10)   { top: 13.1vw; }
.coinown3PC:nth-child(11)   { top: 12.8vw; }
.coinown3PC:nth-child(12)   { top: 12.5vw; }

.coin_destroyed:nth-child(12)  { top: 3.3vw; }
.coin_destroyed:nth-child(11)  { top: 3vw; }
.coin_destroyed:nth-child(10)  { top: 2.7vw; }
.coin_destroyed:nth-child(9)   { top: 2.4vw; }
.coin_destroyed:nth-child(8)   { top: 2.1vw; }
.coin_destroyed:nth-child(7)   { top: 1.8vw; }
.coin_destroyed:nth-child(6)   { top: 1.5vw; }
.coin_destroyed:nth-child(5)   { top: 1.2vw; }
.coin_destroyed:nth-child(4)   { top: 0.9vw; }
.coin_destroyed:nth-child(3)   { top: 0.6vw; }
.coin_destroyed:nth-child(2)   { top: 0.3vw; }
.coin_destroyed:nth-child(1)   { top: 0vw; }



</style>
</head>


<body>

    <form method="post">

        {% if "norm" in player.treatment %}

        <input type="hidden" name="TP_norm_decision1" id="selected-TP_norm_decision1">

        {{ formfield_errors 'TP_norm_decision1' }}

        {% else %}

        <!-- Add hidden input to store the selected value -->
        <input type="hidden" name="TP_decision1" id="selected-number-1">
        <input type="hidden" name="TP_decision2" id="selected-number-2">
        <input type="hidden" name="TP_decision3" id="selected-number-3">
        <input type="hidden" name="TP_decision4" id="selected-number-4">

        {{ formfield_errors 'TP_decision1' }}
        {{ formfield_errors 'TP_decision2' }}
        {{ formfield_errors 'TP_decision3' }}
        {{ formfield_errors 'TP_decision4' }}

        {% endif %}

    {% if role_switch_true == True %}

    <p style="text-align: center;">
    <b style="color: red;">ROLE SWITCH! You are now Person 3!</b>
</p>

    {% endif %}


    {% if "norm" in player.treatment %}

        <div class='responsive-div'>

        <div class='container'>

    {% if dic_identity != "baseline"%}

    <img src="" style='width:50%; position:absolute; right:16vw' class='dictatorCountry'>
    <img src="" style='width:50%; position:absolute; left:16vw' class='receiverCountry'>

    <img src="" style='width:50%; position:absolute; top:7vw; right:22vw' class='dictatorCountryMap'>
    <img src="" style='width:50%; position:absolute; top:7vw; left:22vw' class='receiverCountryMap'>

    {% endif %}


    <img src="/static/{{ image }}" style="width:27vw; position:absolute; left:-25%; top:3vw">


    <span class='coinstack coinstackD'>
    </span>

    <div class="coin-count-labelD" id="countD"></div>


    <span class='coinstack coinstackR'>
    </span>

    <div class="coin-count-labelR" id="countR"></div>



    {% if "punish" in player.treatment %}

    <span class='coinstack coinstackDDes'>
    </span>

    <div class="coin-count-labelDDes" id="countDDes"></div>

{% endif %}

     {% if "reward" in player.treatment %}

    <span class='coinstack coinstackTP3PR'>
    </span>

    <div class="coin-count-labelTP3PR" id="countTP3PR"></div>

{% endif %}

    {% if "comp" in player.treatment %}

    <span class='coinstack coinstackTP3PC'>
    </span>

    <div class="coin-count-labelTP3PC" id="countTP3PC"></div>

{% endif %}


    {% if "3PP" in player.treatment %}
    <img src="/static/global/minus_button.png" alt="-" style="position: absolute; width: 2vw; top: 55%; left: 12%;">
{% endif %}

    {% if "3PR" in player.treatment %}
    <img src="/static/global/plus_button.png" alt="+" style="position: absolute; width: 2vw; top: 55%; left: 15%;">
{% endif %}

    {% if "3PC" in player.treatment %}
    <img src="/static/global/plus_button.png" alt="+" style="position: absolute; width: 2vw; top: 55%; left: 84%;">
{% endif %}

    {% if "2PP" in player.treatment %}
    <img src="/static/global/minus_button.png" alt="-" style="position: absolute; width: 2vw; top: 5%; left: 46%;">
{% endif %}




</div>



     <p> How <b style="color: red;">socially acceptable</b> is it to <b style="color: red;">{{ treatment_text_action }}</b> <span id="dictator_recipient_TPeffect"></span> points {{ treatment_text_receiver }}? </p>



    <div class='numbers'>
    <div class="number-row">
        <div class="norm" data-value="0">very socially<br>unacceptable</div>
        <div class="norm" data-value="1">socially<br>unacceptable</div>
        <div class="norm" data-value="2">slightly socially<br>unacceptable</div>
        <div class="norm" data-value="3">slightly socially<br>acceptable</div>
        <div class="norm" data-value="4">socially<br>acceptable</div>
        <div class="norm" data-value="5">very socially<br>acceptable</div>
    </div>
</div>



        <hr>
</div>



    {% else %}




        {% for TP_decision in TP_decisions %}
        <div class='responsive-div'>

            <div class='container' data-index="{{ TP_decision.index }}">

                {% if dic_identity != "baseline"%}

                <img src="" style='width:50%; position:absolute; right:16vw' class='dictatorCountry'>
                <img src="" style='width:50%; position:absolute; left:16vw' class='receiverCountry'>

                <img src="" style='width:50%; position:absolute; top:7vw; right:22vw' class='dictatorCountryMap'>
                <img src="" style='width:50%; position:absolute; top:7vw; left:22vw' class='receiverCountryMap'>

                {% endif %}

                <img src="/static/{{ image }}" style="width:27vw; position:absolute; left:-25%; top:3vw">


                <!-- <img src='/static/baseline/3PP punish.png' style='width:27vw; position:absolute; left:20%; top:3vw'>  -->

                <span class='coinstack coinstackD' data-index="{{ TP_decision.index }}"></span>

                <div class="coin-count-labelD" id="countD" data-index="{{ TP_decision.index }}"></div>

                <span class='coinstack coinstackR' data-index="{{ TP_decision.index }}"></span>

                <div class="coin-count-labelR" id="countR" data-index="{{ TP_decision.index }}"></div>



                {% if "punish" in player.treatment or "3PP country" in player.treatment %}

                    <span class='coinstack coinstackDDes' data-index="{{ TP_decision.index }}"></span>

                    <div class="coin-count-labelDDes" id="countDDes" data-index="{{ TP_decision.index }}"></div>

                {% endif %}

                 {% if "reward" in player.treatment %}

                    <span class='coinstack coinstackTP3PR' data-index="{{ TP_decision.index }}"></span>

                    <div class="coin-count-labelTP3PR" id="countTP3PR" data-index="{{ TP_decision.index }}"></div>

                {% endif %}

                {% if "comp" in player.treatment %}

                    <span class='coinstack coinstackTP3PC' data-index="{{ TP_decision.index }}"></span>

                    <div class="coin-count-labelTP3PC" id="countTP3PC" data-index="{{ TP_decision.index }}"></div>

                {% endif %}

                {% if "3PP" in player.treatment %}
                    <img src="/static/global/minus_button.png" alt="-" style="position: absolute; width: 2vw; top: 55%; left: 12%;">
                {% endif %}

                {% if "3PR" in player.treatment %}
                    <img src="/static/global/plus_button.png" alt="+" style="position: absolute; width: 2vw; top: 55%; left: 15%;">
                {% endif %}

                {% if "3PC" in player.treatment %}
                    <img src="/static/global/plus_button.png" alt="+" style="position: absolute; width: 2vw; top: 55%; left: 84%;">
                {% endif %}

            {% if "2PP" in player.treatment %}
                <img src="/static/global/minus_button.png" alt="-" style="position: absolute; width: 2vw; top: 5%; left: 46%;">

                 <p>
            <b style="color: red; font-size: 24px; position: absolute; top: 25.5%; left:101%;">YOU</b>
        </p>

            {% else %}

            <p>
            <b style="color: red; font-size: 24px; position: absolute; top: 75%; left:46%;">YOU</b>
        </p>

            {% endif %}

            </div>


                <p> How much do you <b style="color: red;"> {{ treatment_text_action }} </b>  {{ treatment_text_receiver }}? </p>

                <div class='numbers'>
                    <div class="number-row" data-index="{{ TP_decision.index }}" data-input="selected-number-{{ TP_decision.index }}">
                        {{ for num in TP_points }}
                        <div class="number" data-value="{{ num }}" data-index="{{ TP_decision.index }}">{{ num }}</div>
                        {{ endfor }}
                    </div>
                </div>

             <br>

            <hr>

            </div>
            {% endfor %}

        {% endif %}

        <br>

       <div style="display: flex; justify-content: flex-end">
            <button type="button" id="submit-button">Next</button>
        </div>

    </form>

</body>
</html>



{{ endblock }}
