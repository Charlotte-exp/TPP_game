{{ block title }}

Knowledge check

{{ endblock }}
{{ block content }}

<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1.0">


<script src="https://code.jquery.com/jquery-3.6.0.min.js" ></script>


<script>

    /////////// global variables

    var current_treatment = "{{ treatment }}";


    //// error message handling for no-response versus incorrect-response

    var correct_answers = {{correct_answers}}

    /// Function for showing customized error messages
    let errorDiv = document.querySelector('.otree-form-errors');

    if (errorDiv) {
            errorDiv.textContent = "Please select the correct answer."
        }




////////////// function for displaying the task, numbers, and labels and managing the click event

    $(document).ready(function () {

                // Initialize coin stacks and number labels for each decision
        // universal_norm_decisions.forEach((universal_norm_decision) => {
        //     const index = universal_norm_decision.index;
        //     const dictatorKeeps = universal_norm_decision.dictator_keeps;
        //     const receiverGets = universal_norm_decision.receiver_gets;
        //
        //     // Fill initial coin stacks and number labels (norm condition)
        //
        //         // dictator stack
        //         for (let i = 0; i < dictatorKeeps; i++) {
        //             $(`.coinstackD[data-index="${index}"]`).append('<div class="coin" style="left:19%;"></div>');
        //         }
        //         // receiver stack
        //         for (let i = 0; i < receiverGets; i++) {
        //             $(`.coinstackR[data-index="${index}"]`).append('<div class="coinR" style="left:50%;"></div>');
        //         }
        //         // number labels
        //         $('#countD[data-index="' + index + '"]').text(`${dictatorKeeps}`);
        //         $('#countR[data-index="' + index + '"]').text(`${receiverGets}`);
        //
        // });

        //Actions on click: ALTERNATIVE NORM MEASURE
        $('.comprehension_option').on('click', function () {
            // Remove 'selected' class from all buttons
            $(this).closest('.comprehension-row').find('.comprehension_option').removeClass('selected');

            // Add 'selected' class to the clicked button
            $(this).addClass('selected');

            // Get the value of the clicked button
            const value = $(this).data('value');
            // const index = $(this).data('index');

            // Update the hidden input fields
            if (current_treatment.includes("2PP") ) { // in norm condition
                $('#selected-comprehension2PP').val(value);
                index = 0
            }
            if (current_treatment.includes("3PR") ) { // in norm condition
                $('#selected-comprehension3PR').val(value);
                index=1;
            }
            if (current_treatment.includes("3PC") ) { // in norm condition
                $('#selected-comprehension3PC').val(value);
                index =2;
            }

            console.log("selected_value, correct_answers, correct_answers[index]", value, correct_answers, correct_answers[index])

            // Check if the value is correct, and show feedback
            if (errorDiv) { // If there is already an error, which was caused by clicking next: Update the error message, because otherwise no way to remove error message
                if (value == correct_answers[index]) { //If correct
                    errorDiv.textContent = "Correct answer! Please press 'Next'."
                    errorDiv.style.color = 'green';
                    errorDiv.style.backgroundColor = 'lightgreen';
                    errorDiv.style.border = '1px solid green'
                } else { //If incorrect
                    errorDiv.textContent = "Wrong answer! Please select the correct answer."
                    errorDiv.style.color = '';
                    errorDiv.style.backgroundColor = '';
                    errorDiv.style.border = ''
                }
            }
            else { // If no error
                if (value == correct_answers[index]) {
                    $('#correct-message').show();
                    $('#incorrect-message').hide();
                } else {
                    $('#correct-message').hide();
                    $('#incorrect-message').show();
                }
            }

            // // Update the hidden input field
            // $(`#selected-number-${index}`).val(value);
            // // This is usually done by the coinstack logic somewhere
            // // since we don't update coinstacks for norms we need to add this
            // // maybe we don't even need the stored array...
            // universal_norm_decisions[index - 1].universal_norm_decision = value;


            // Debugging
            //console.log(`Updated norm decision at index ${index}: ${value}`);
        });

        // Submit button click handler
        $('#submit-button').on('click', function () {
            // Submit the form
            $('form').submit();
        });



    });

</script>


<style>

    body {
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin-top: 4vw;
        background-color: #f4f4f4;
    }

    .comprehension-row {
        display: flex;
        flex-direction: column; /* Stack items vertically */
        justify-content: center; /* Center the items */
        margin-top: 0vw; /* Adjust the top margin */
        gap: 0.5vw; /* Space between items */
    }

    .comprehension-row-close {
        justify-content: center;
        display: flex;
        margin-top:3vw;
        /*gap: 1vw; PREVIOUS GAP WITH 30 ENDOWMENT !* Space between numbers scales with viewport width *!*/
        gap: 0vw; /* Space between numbers scales with viewport width */
        flex-wrap: wrap; /* Optional: allows wrapping if buttons exceed container width */
        align-items: center; /* Ensures proper vertical alignment */
    }

    .comprehension-row-static {
        justify-content: center;
        display: flex;
        margin-top:-2vw;
        /*gap: 1vw; PREVIOUS GAP WITH 30 ENDOWMENT !* Space between numbers scales with viewport width *!*/
        gap: 0.5vw; /* Space between numbers scales with viewport width */
        flex-wrap: wrap; /* Optional: allows wrapping if buttons exceed container width */
        align-items: center; /* Ensures proper vertical alignment */
    }

    .number {
        width: 2.5vw; /* Width scales with viewport width */
        height: 3vw; /* Height scales with viewport width */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5vw; /* Font size scales with viewport width */
        background-color: #e0e0e0;
        border: 2px solid #000000;
        cursor: pointer;
        font-family: Arial, Helvetica, sans-serif;
        transition: background-color 0.3s ease;
    }

    .recorded_norm {
        width: 6vw; /* Width scales with viewport width */
        height: 5vw; /* Height scales with viewport width */
        flex-direction: column;
        text-align: center; /* Center-aligns the text */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.9vw; /* Font size scales with viewport width */
        background-color: #e0e0e0;
        border: 2px solid #000000;
        border-radius: 10%; /* Slightly rounded corners */
        cursor: pointer;
        font-family: Arial, Helvetica, sans-serif;
        transition: background-color 0.3s ease;
    }

    .comprehension_option {
        width: 90%; /* Width scales with viewport width */
        height: 3vw; /* Height scales with viewport width */
        flex-direction: column;
        text-align: center; /* Center-aligns the text */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.9vw; /* Font size scales with viewport width */
        background-color: #e0e0e0;
        border: 2px solid #000000;
        border-radius: 10%; /* Slightly rounded corners */
        cursor: pointer;
        font-family: Arial, Helvetica, sans-serif;
        transition: background-color 0.3s ease;
    }

    .number:hover {
        background-color: #ffcc00; /* Change background color on hover */
    }

    .number:active {
        background-color: #ffa500; /* Change background color on click */
    }

    .number.selected {
             background-color: #ffa500; /* Permanent color when clicked */
    }

    .number.disabled {
        background-color: #F3F3F3; /* Grey color for disabled buttons */
        border: 2px solid #d3d3d3;
        color:#d3d3d3;
        cursor: not-allowed;
        pointer-events: none; /* Disable interactions */
    }

    .comprehension_option:hover {
        background-color: #ffcc00; /* Change background color on hover */
    }

    .comprehension_option:active {
        background-color: #ffa500; /* Change background color on click */
    }

    .comprehension_option.selected {
             background-color: #ffa500; /* Permanent color when clicked */
    }

    .recorded_norm.selected {
             background-color: #ffa500; /* Permanent color when clicked */
    }

    .comprehension_option.disabled {
        background-color: #F3F3F3; /* Grey color for disabled buttons */
        border: 2px solid #d3d3d3;
        color:#d3d3d3;
        cursor: not-allowed;
        pointer-events: none; /* Disable interactions */
    }

    .responsive-div {
      width: 90%; /* Default width */
      transform-origin: top left; /* Ensure scaling starts from top-left */
      transform: scale(1); /* Default scale */
      transition: transform 0.3s ease; /* Smooth scaling */
      /*border:1px solid black;*/
      margin-left:auto;
      margin-right:auto;
    }

    .container {
        width:45%;
        height:25vw;
        margin-left:auto;
        margin-right:auto;
        border:0px solid black;
        position:relative;
    }

    .reminder {
        background-color: #e0f0ff;
        color: #004080;
        border: 1px solid #004080;
        padding: 8px;
        margin-top: 15px;
        border-radius: 5px;
        font-size: 14px;
    }

    .comprehension-error-red {
        color: #a94442; /* Bootstrap default error text color (dark red) */
        background-color: #f2dede; /* Light red background */
        border: 1px solid #ebccd1; /* Red border */
        padding: 10px; /* Padding for spacing */
        border-radius: 4px; /* Slightly rounded corners */
        margin-bottom: 15px; /* Spacing below the error */
        display: none; /* Initially hidden */
        /*font-size: 14px;*/
    }

    .comprehension-error-green {
        color: green; /* Bootstrap default error text color (dark red) */
        background-color: lightgreen; /* Light red background */
        border: 1px solid green; /* Red border */
        padding: 10px; /* Padding for spacing */
        border-radius: 4px; /* Slightly rounded corners */
        margin-bottom: 15px; /* Spacing below the error */
        display: none; /* Initially hidden */
        /*font-size: 14px;*/
    }


    .short-container {
        width:45%;
        height:15vw;  # shorter for dictator
        margin-left:auto;
        margin-right:auto;
        border:0px solid black;
        position:relative;
    }

    @media (max-width: 1200px) {
      .responsive-div {
        transform: scale(1.0); /* Scale to 80% for smaller screens */
      }
      .container {
          margin-left:10vw;
      }
      .numbers {
          position:absolute;
          transform: scale(0.95);
          left:6vw;
      }
    }

    @media (max-width: 800px) {
      .responsive-div {
        transform: scale(2); /* Scale to 60% for even smaller screens */
      }
      .container {
          margin-left:1vw;
      }
      .short.container {
          margin-left:1vw;
      }
      .numbers {
          position:absolute;
          transform: scale(0.95);
          left:-3.2vw;
      }
      .number {
          font-size:2vw;
          border-width:1px;
      }
    }

    .coin {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coinR {
        width: 1.8vw; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coin-count-labelD {
    font-size: 1.2rem;
    color: #333; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 30%; /* Center horizontally */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 32%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}


    .coin-count-labelR {
    font-size: 1.2rem;
    color: #333; /* Adjust color as needed */
    position: absolute; /* Position relative to .container */
    left: 60%; /* Center horizontally, previously 73 */
    transform: translateX(-50%); /* Adjust for exact centering */
    top: 13%; /* Move up; adjust value as needed */
    text-align: center; /* Align text */
}



    .coin:nth-child(12)  { top: 6.0vw; }
    .coin:nth-child(11)  { top: 6.3vw; }
    .coin:nth-child(10)  { top: 6.6vw; }
    .coin:nth-child(9)   { top: 6.9vw; }
    .coin:nth-child(8)   { top: 7.2vw; }
    .coin:nth-child(7)   { top: 7.5vw; }
    .coin:nth-child(6)   { top: 7.8vw; }
    .coin:nth-child(5)   { top: 8.1vw; }
    .coin:nth-child(4)   { top: 8.4vw; }
    .coin:nth-child(3)   { top: 8.7vw; }
    .coin:nth-child(2)   { top: 9.0vw; }
    .coin:nth-child(1)   { top: 9.3vw; }

    .coinR:nth-child(12)  { top: 1.3vw; }
    .coinR:nth-child(11)  { top: 1.6vw; }
    .coinR:nth-child(10)   { top: 1.9vw; }
    .coinR:nth-child(9)   { top: 2.2vw; }
    .coinR:nth-child(8)   { top: 2.5vw; }
    .coinR:nth-child(7)   { top: 2.8vw; }
    .coinR:nth-child(6)   { top: 3.1vw; }
    .coinR:nth-child(5)   { top: 3.4vw; }
    .coinR:nth-child(4)   { top: 3.7vw; }
    .coinR:nth-child(3)   { top: 4.0vw; }
    .coinR:nth-child(2)   { top: 4.3vw; }
    .coinR:nth-child(1)  { top: 4.6vw; }


</style>
</head>


<body>

<form method="post">

     {% if "2PP" in player.treatment %}
        <!-- Add hidden input to store the selected value -->
        <input type="hidden" name="comprehension2PP" id="selected-comprehension2PP">

<!--        {{ formfield_errors 'comprehension2PP' }}-->

    {% elif "3PR" in player.treatment %}
         <!-- Add hidden input to store the selected value -->
        <input type="hidden" name="comprehension3PR" id="selected-comprehension3PR">

<!--        {{ formfield_errors 'comprehension3PR' }}-->

    {% else %}

     <!-- Add hidden input to store the selected value -->
        <input type="hidden" name="comprehension3PC" id="selected-comprehension3PC">

<!--        {{ formfield_errors 'comprehension3PC' }}-->

    {% endif %}

    <div class="comprehension-error-green" id="correct-message" >
        Correct answer! Please press 'Next'.
    </div>

    <div class="comprehension-error-red" id="incorrect-message" >
        Wrong answer! Please select the correct answer.
    </div>


    {% if "2PP" in player.treatment %}

        <div class='responsive-div'>

            <p> If <b>Person B</b> would remove <b>1 point</b> from <b>Person A</b> in Stage 2, <b>what would be the effect?</b>  </p>

            <div class='numbers'>
                <div class="comprehension-row" data-input="selected-number-1">
                    <div class="comprehension_option" data-value="0" >Person A would lose 3 point(s) and Person C would lose 0.33 point(s). </div>
                    <div class="comprehension_option" data-value="1" >Person A would lose 3 point(s) and Person C would lose 1 point(s).</div>
                    <div class="comprehension_option" data-value="2" >Person A would lose 1 point(s) and Person C would lose 0.33 point(s).</div>
                    <div class="comprehension_option" data-value="3" >Person A would lose 1 point(s) and Person C would lose 1 point(s).</div>
                </div>
            </div>

        <br>
        <hr>

        </div>

    <div class="reminder">

                <p style="text-align: center; ">
                    <b>Reminder</b>
                </p>

<!--                <p> There are <strong>two stages</strong>. </p>-->

<!--                <p> <b> Stage 1: </b> </p>-->

<!--                <div style="margin-left: 5%;">-->

<!--                    <p><strong>Person A</strong> receives 12 points.<br>-->
<!--                            <strong>Person B</strong> receives 0 points.</p>-->

<!--                    <p><strong>Person A</strong> decides how many of the 12 points to give to Person B.</p>-->

<!--                </div>-->

<!--                <p> <b>Stage 2:</b> </p>-->

                <div style="margin-left: 5%;">

                    <p> <b>Person B</b> is able to <strong>remove points</strong> from <strong>Person A</strong>. </p>

                    <p>Person A and Person B both receive 4 points in Stage 2. Only Person B can use these points to remove points from Person A. Removed points are eliminated and cannot be used by anyone. Removing <b>3 points</b> from Person A will cost Person B <b>1 point</b> (cost of removing 1 point = 0.33 points).</p>
                </div>
            </div>

    {% endif %}

    {% if "3PR" in player.treatment %}


        <div class='responsive-div'>

            <p> If <b>Person C</b> would give <b>3 point(s)</b> to <b>Person A</b> in Stage 2, <b>what would be the effect?</b>  </p>

            <div class='numbers'>
                <div class="comprehension-row" data-input="selected-number-1">
                    <div class="comprehension_option" data-value="0" >Person A would gain 1 point(s) and Person C would lose 0.33 point(s). </div>
                    <div class="comprehension_option" data-value="1" >Person A would gain 1 point(s) and Person C would lose 1 point(s).</div>
                    <div class="comprehension_option" data-value="2" >Person A would gain 3 point(s) and Person C would lose 0.33 point(s).</div>
                    <div class="comprehension_option" data-value="3" >Person A would gain 3 point(s) and Person C would lose 1 point(s).</div>
                </div>
            </div>

        <br>
        <hr>

        </div>

    {% endif %}

    {% if "3PC" in player.treatment %}

        <div class='responsive-div'>

            <p> If <b>Person C</b> would give <b>3 point(s)</b> to <b>Person B</b> in Stage 2, <b>what would be the effect?</b>  </p>

            <div class='numbers'>
                <div class="comprehension-row" data-input="selected-number-1">
                    <div class="comprehension_option" data-value="0" >Person A would lose 0 point(s), Person B would gain 3 points and Person C would lose 1 point(s). </div>
                    <div class="comprehension_option" data-value="1" >Person A would lose 0 point(s), Person B would lose 3 points and Person C would lose 0.33 point(s).</div>
                    <div class="comprehension_option" data-value="2" >Person A would lose 3 point(s), Person B would lose 3 points and Person C would lose 0.33 point(s).</div>
                    <div class="comprehension_option" data-value="3" >Person A would lose 3 point(s), Person B would gain 3 points and Person C would lose 1 point(s).</div>
                </div>
            </div>

        <br>
        <hr>

        </div>

{% endif %}



<br>

   <div style="display: flex; justify-content: flex-end">
        <button style="color: #fff;
                       background-color: #007bff;
                       border: 1px solid #007bff;
                       font-size: 1rem;
                       border-radius: 0.25rem;
                       padding: 4px 12px;" type="button" id="submit-button">
            Next
        </button>
    </div>


</form>




</body>
</html>





{{ endblock }}
