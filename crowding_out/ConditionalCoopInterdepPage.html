{{ block title }}

{% if lang == "ar" %}
<html lang="ar" dir="rtl">
{% endif %}

<div class="block-header">
    {{ button_block|safe }}
</div>

<p style="text-align: center; font-size: 26px;  "> {{ button_decision|safe }} {{ participant.decision_page_number }} </p>

<div style="display: flex; justify-content: center; margin-bottom: 4px;">
    <label>
        <progress value="{{ participant.progress }}" max="{{ total_pages }}">
        </progress>
    </label>
</div>


{{ endblock }}
{{ block content }}

<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% load static %}
    <link rel="stylesheet" href="{% static 'shared_styles.css' %}">


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>

    /////////// global variables

    let crowding_decision1_stored = 0; // Array to store selected values for each row
    //console.log(`norm decisions values: ${dic_norm_decisions_stored}`);

    var current_treatment = "{{ treatment_incentive }}";

    var error1 = "{{ error1 }}";

    total_endowment = {{ total_endowment }}
    receiver_endowment = {{ receiver_endowment }}
    incentive = {{ incentive }}


    /// Function for showing customized error messages
    const errorDiv = document.querySelector('.otree-form-errors');

    if (errorDiv) {
        errorDiv.textContent = error1
    }





    $(document).ready(function () {

            // Fill initial coin stacks and number labels (norm condition)

            // dictator stack
            for (let i = 0; i < total_endowment; i++) {
                $(`.coinstackD`).append('<div class="coinD" style="left:calc(50% - 75px)"></div>');
            }
            // dictator stack static (for static display of role labels in norm Q)
            for (let i = 0; i < receiver_endowment; i++) {
                $(`.coinstackD-static`).append('<div class="coinD" style="left:calc(50% - 75px)"></div>');
            }
            // recipient stack static (for static display of role labels in norm Q)
            for (let i = 0; i < total_endowment; i++) {
                $(`.coinstackR-static`).append('<div class="coinRbis" style="left:calc(50% - 3px)"></div>');
            }
            // incentive stack static (for static display of role labels in norm Q)
            for (let i = 0; i < incentive; i++) {
                $(`.coinstackTP3PR-static`).append('<div class="coinown3PR" style="left:calc(50% - 100px)"></div>');
            }

            // number labels
            $('.coin-count-labelD').text(`${total_endowment}`);
            $('.coin-count-labelR').text(`${receiver_endowment}`);
            $('.coin-count-labelTP3PR').text(`${receiver_endowment}`);
            //$('.coin-count-labelD-static').text(`${receiver_endowment}`);
            $('.coin-count-labelR-static').text(`${total_endowment}`);
            $('.coin-count-labelTP3PR-static').text(`${incentive}`);


        const hiddenInput = $('#selected-proportion-1');
        const checkbox = $('#not_applicable1');
        const errorDiv = $('#error-message');

        // Button selection logic
        $('.proportion').on('click', function () {
            // $(this).closest('.proportion-column').find('.proportion').removeClass('selected');
            $('.proportion, .proportion-fullwidth').removeClass('selected');
            $(this).addClass('selected');

            const value = $(this).data('value');
            hiddenInput.val(value);

            checkbox.prop('checked', false); // Uncheck checkbox if a button is clicked
            errorDiv.hide();

            console.log("hiddenInput.val()", hiddenInput.val())
        });

        // Button selection logic
        $('.proportion-fullwidth').on('click', function () {
            // $(this).closest('.proportion-column').find('.proportion').removeClass('selected');
            $('.proportion, .proportion-fullwidth').removeClass('selected');
            $(this).addClass('selected');

            const value = $(this).data('value');
            hiddenInput.val(value);

            checkbox.prop('checked', false); // Uncheck checkbox if a button is clicked
            errorDiv.hide();

            console.log("hiddenInput.val()", hiddenInput.val())
        });

        // Form validation
        $('#submit-button').on('click', function (e) {
            console.log("hiddenInput.val()", hiddenInput.val())
            const selectedValue = hiddenInput.val();

            if (!selectedValue) {
                e.preventDefault();
                document.getElementById("error-message").style.display = "block";
                errorDiv.show();
            } else {
                $('form').submit();  // Optional; may be redundant if button is already a type="submit"
            }
        });

    });



</script>


<style>

    .proportion-row {
        display: flex;
        flex-direction: column; /* Stack items vertically */
        justify-content: center; /* Center the items */
        margin-top: 0vw; /* Adjust the top margin */
        gap: 0.5vw; /* Space between items */
    }

    .proportion {
        flex-direction: column;
        text-align: center; /* Center-aligns the text */
        display: flex;
        justify-content: center;
        cursor: pointer;
        align-items: center;
        font-size: 14px; /* Font size scales with viewport width */
        background-color: #e0e0e0;
        padding: 10px 12px;
        border: 1.5px solid #000000;
        border-radius: 6px; /* Slightly rounded corners */
        font-family: Arial, Helvetica, sans-serif;
        transition: background-color 0.3s ease;
        display: inline;
    }

    .proportion:hover {
        background-color: #ffcc00; /* Change background color on hover */
    }

    .proportion:active {
        background-color: #ffa500; /* Change background color on click */
    }

    .proportion.selected {
             background-color: #ffa500; /* Permanent color when clicked */
    }

    .proportion.disabled {
        background-color: #F3F3F3; /* Grey color for disabled buttons */
        border: 2px solid #d3d3d3;
        color:#d3d3d3;
        cursor: not-allowed;
        pointer-events: none; /* Disable interactions */
    }

    .conditional-row-wrapper {
    display: flex;
    align-items: stretch;
    margin-top: 20px;
    gap: 20px;
}

/* Left column with buttons */
.proportion-column {
    flex: 3;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* Right column: sentence that completes all options */
.proportion-completion {
    flex: 1;
    font-size: 14px; /* Font size scales with viewport width */
    margin-top: -30px; /* Push text up a bit */
    line-height: 2.8;
    /*color: #444;*/
    display: flex;
    align-items: center;
    justify-content: flex-start;
    text-align: center;
    padding-top: 5px;
}

.proportion-fullwidth {
    margin-top: 20px;
    padding: 10px 12px;
    border: 1.5px solid #000000;
    cursor: pointer;
    border-radius: 6px; /* Slightly rounded corners */
    text-align: center;
    background-color: #e0e0e0;
    font-size: 14px;
}

.proportion-fullwidth:hover {
    background-color: #ffcc00;
}

.proportion-fullwidth.selected {
    background-color: #ffa500;
}


    .coinD {
        width: 20px; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 1px solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coinRbis {
        width: 20px; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 1px solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coinown3PR {
        width: 20px; /* Coins take the full width of the stack container */
        min-width:10px;
        height: 8px; /* Coin height is proportional to the width */
        border-radius: 50%;
        background: linear-gradient(145deg, #ffd700, #e6c200);
        border: 0.1vw solid #FFFFFF; /* Border size scales with the coin size */
        box-shadow: inset -3px -2px 5px rgba(0, 0, 0, 0.2);
        position: absolute;
        transform: translateX(-50%);
    }

    .coin-count-labelD {
        font-size: 14px;
        color: #333; /* Adjust color as needed */
        position: absolute; /* Position relative to .container */
        transform: translateX(-50%); /* Adjust for exact centering */
        left:calc(50% - 56px); /* Center horizontally */
        top: 58px; /* Move up; adjust value as needed */
        text-align: center; /* Align text */
    }

    .coin-count-labelD-static {
        font-size: 14px;
        color: #333; /* Adjust color as needed */
        position: absolute; /* Position relative to .container */
        left:calc(50% - 56px); /* Center horizontally */
        transform: translateX(-50%); /* Adjust for exact centering */
        top: 58px; /* Move up; adjust value as needed */
        text-align: center; /* Align text */
    }

    .coin-count-labelR {
        font-size: 14px;
        color: #333; /* Adjust color as needed */
        position: absolute; /* Position relative to .container */
        transform: translateX(-50%); /* Adjust for exact centering */
        left:calc(50% + 15px); /* Center horizontally */
        top: 12px; /* Move up; adjust value as needed */
        text-align: center; /* Align text */
    }
    .coin-count-labelR-static {
        font-size: 14px;
        color: #333; /* Adjust color as needed */
        position: absolute; /* Position relative to .container */
        left:calc(50% + 15px); /* Center horizontally */
        transform: translateX(-50%); /* Adjust for exact centering */
        top: 12px; /* Move up; adjust value as needed */
        text-align: center; /* Align text */
    }

    .coin-count-labelTP3PR {
        position: absolute;
        font-size: 14px;
        top: 153px;
        left:calc(50% - 78px);
    }

    .coin-count-labelTP3PR-static {
        position: absolute;
        font-size: 14px;
        top: 153px;
        left:calc(50% - 83px);
    }

    .coinD:nth-child(8)  { top: 48px; }
    .coinD:nth-child(7)  { top: 51px; }
    .coinD:nth-child(6)  { top: 54px; }
    .coinD:nth-child(5)  { top: 57px; }
    .coinD:nth-child(4)  { top: 60px; }
    .coinD:nth-child(3)  { top: 63px; }
    .coinD:nth-child(2)  { top: 66px; }
    .coinD:nth-child(1)  { top: 69px; }

    .coinRbis:nth-child(4)  { top:12px; }
    .coinRbis:nth-child(3)  { top: 15px; }
    .coinRbis:nth-child(2)  { top: 18px; }
    .coinRbis:nth-child(1)  { top: 21px; }

    .coinown3PR:nth-child(2)  { top: 156px; }
    .coinown3PR:nth-child(1)  { top: 159px; }

    .image-container {
        display: flex;
        justify-content: center;
        align-items: flex-start; /* Align to the top of the container */
        gap: 30px;
        margin-top: 20px;
    }

    /*    .extras-container {*/
    /*    position: relative;*/
    /*}*/

     /* Treatment-specific heights */
    .treatment-true .coin-img {
        max-height: 155px;
    }

    .treatment-true .charity-img {
        max-height: 80px;
    }

    .treatment-false .coin-img,
    .treatment-false .charity-img {
        max-height: 80px;
    }

    /* Optional: prevent weird inline spacing */
    .coin-img, .charity-img {
        display: block;
    }

    .label-a {
        position: absolute;
        font-size: 14px;
        left:calc(50% - 165px);
        top: 75px;
    }

    .label-charity {
        position: absolute;
        font-size: 14px;
        left:calc(50% + 90px);
        top: 76px;
    }

    .label-you {
        color: red;
        font-size: 18px;
        position: absolute;
        left:calc(50% - 148px);
        top: 46px;
    }

    .plus-button {
        position: absolute;
        width: 22px;
        top: 130px;
        left:calc(50% - 85px);
    }





    .slider {
        width: 100%;
        margin: 20px 0;
    }

    .slider-container {
        width: 100%;
        max-width: 600px;
        margin: auto;
    }

    .slider-labels {
        display: flex;
        justify-content: space-between;
        text-align: center;
        margin-top: -10px; /* optional: pulls labels closer to slider */
    }

    .slider-labels span {
        flex: 1;
        text-align: center;
        font-size: 16px;
    }

    @media (max-width: 400px) { /* adjustments for tiny screens */
        .slider-labels span {
            font-size: 12px;
        }
    }

/* Webkit-based browsers (Chrome, Safari) */
    input[type=range]::-webkit-slider-runnable-track {
        width: 100%;
        height: 8.4px;
        cursor: pointer;
        background: white;
        border-radius: 1px;
        border: 1px solid lightgrey;
    }

    /* Firefox */
    input[type=range]::-moz-range-track {
        width: 100%;
        height: 8.4px;
        cursor: pointer;
        background: white;
        border-radius: 1px;
        border: 1px solid lightgrey;
    }

    /* Internet Explorer and Edge */
    input[type=range]::-ms-track {
        width: 100%;
        height: 8.4px;
        cursor: pointer;
        background: white;
        border-radius: 1px;
        border: 1px solid lightgrey;
        /* Remove default styling for MS track */
        border-color: transparent;
        color: transparent;
        background-color: transparent;
    }

    /* Style the range input element itself to reset default styling across browsers */
    input[type=range] {
        -webkit-appearance: none; /* For Webkit browsers */
        appearance: none; /* For Firefox and other browsers */
        width: 100%;
        height: 8px; /* Adjust the input height */
        background: transparent; /* Make sure the input background is transparent */
        border: none; /* Remove default border */
        margin-top: 5px;
    }

    /* Hide the thumb initially for Safari/Chrome */
    .hidden-thumb::-webkit-slider-thumb {
        opacity: 0;  /* Instead of visibility: hidden */
        pointer-events: none;  /* Prevent user from interacting */
    }

    /* Hide the thumb initially for Firefox */
    .hidden-thumb::-moz-range-thumb {
        opacity: 0;  /* Instead of visibility: hidden */
        pointer-events: none;  /* Prevent user from interacting */
    }

    /* Hide the thumb initially for IE/Edge */
    .hidden-thumb::-ms-thumb {
        opacity: 0;  /* Instead of visibility: hidden */
        pointer-events: none;  /* Prevent user from interacting */
    }

    /* Style the slider thumb for Safari/Chrome */
    input[type=range]::-webkit-slider-thumb {
        border: 0px solid #000000;
        height: 21px;
        width: 10px;
        background: #0d6efd;
        cursor: pointer;
        -webkit-appearance: none;
        margin-top: -7px;
    }

    /* Style the slider thumb for Firefox */
    input[type=range]::-moz-range-thumb {
        border: 0px solid #000000;
        height: 21px;
        width: 10px;
        background: #0d6efd;
        cursor: pointer;
        -moz-appearance: none;  /* Firefox-specific appearance reset */
        margin-top: -7px;
    }

    /* Style the slider thumb for IE/Edge */
    input[type=range]::-ms-thumb {
        border: 0px solid #000000;
        height: 21px;
        width: 10px;
        background: #0d6efd;
        cursor: pointer;
        -ms-appearance: none;  /* Edge/IE-specific appearance reset */
        margin-top: -7px;
    }

    .slide-text p {
        font-size: 1.5vw; /* smaller than before */
        line-height: 1.3em;
    }

    @media (min-width: 1200px) {
        .slide-text p {
            font-size: 1rem; /* desktop max size */
        }
    }

    @media (max-width: 600px) {
        .slide-text p {
            font-size: 3vw; /* smaller on small screens */
        }
    }

    .example-text {
        font-size: 1.5vw; /* scales with screen width */
        font-weight: bold;
        text-align: center;
    }

    @media (min-width: 1200px) {
        .example-text {
            font-size: 1rem; /* max size on large screens */
        }
    }

    @media (max-width: 600px) {
        .example-text {
            font-size: 3vw; /* smaller on phones */
        }
    }



</style>
</head>


<body>

<form method="post">

    <div class='responsive-div'>

<!--        <div class="image-container {% if treatment_incentive %}treatment-true{% else %}treatment-false{% endif %}">-->

<!--            <img id="coin-image"-->
<!--                 src="{% static image %}"-->
<!--                 alt="Coins"-->
<!--                 class="coin-img" />-->

<!--            <img id="charity-image"-->
<!--                 src="{% static 'global/charities/unknown_charity.png' %}"-->
<!--                 alt="Selected charity"-->
<!--                 class="charity-img" />-->
<!--        </div>-->

<!--        <div class="extras-container {% if treatment_incentive %}treatment-true{% else %}treatment-false{% endif %}">-->
<!--            <p><b class="label-a">{{ person_a|safe }}</b></p>-->
<!--            <p><b class="label-charity">{{ button_charity|safe }}</b></p>-->

<!--            <span class='coinstack coinstackD-static'></span>-->
<!--            <div class="coin-count-labelD-static" id="countD"></div>-->

<!--            <span class='coinstack coinstackR-static'></span>-->
<!--            <div class="coin-count-labelR-static" id="countR"></div>-->


<!--            {% if treatment_incentive %}-->
<!--                <img src="{% static 'global/plus_button.png' %}" alt="+" class="plus-button">-->

<!--                <span class="coinstack coinstackTP3PR-static"></span>-->
<!--                <div class="coin-count-labelTP3PR-static" id="countTP3PR-static"></div>-->
<!--            {% endif %}-->

<!--        </div>-->
<!--        -->
<!--        <br>-->

        <p style="text-align: center; ">
            <i>{{ cond_coop_new_decision|safe }}</i>
        </p>

        <p style="text-align: center; ">
            {{ cond_coop_group|safe }}
        </p>

        <p style="text-align: center; ">
            {{ cond_coop_interdependent_explanation1|safe }} {{ cond_coop_interdependent_explanation2|safe }} {{ cond_coop_interdependent_explanation3|safe }}
        </p>

<!--        <p style="text-align: center; ">-->
<!--            {{ cond_coop_interdependent_explanation3|safe }}-->
<!--        </p>-->


        <p style="text-align: center; ">
            {{ cond_coop_question_donor_nondonor_interdep|safe }}
        </p>

        <input type="hidden" name="cond_coop_interdep" id="selected-proportion-1">

        <!-- New full-width unconditional option below -->
        <div class="proportion-fullwidth" data-value="0">
            {{ unconditional_give|safe }}
        </div>

        <div class="conditional-row-wrapper">
            <!-- Left: clickable options -->
            <div class="proportion-column" data-input="selected-proportion-1">
                <div class="proportion" data-value="30"> {{ cond_coop_30|safe }} <b><u>{{ cond_coop_action|safe }}</u></b> </div>
                <div class="proportion" data-value="40"> {{ cond_coop_40|safe }} <b><u>{{ cond_coop_action|safe }}</u></b> </div>
                <div class="proportion" data-value="50"> {{ cond_coop_50|safe }} <b><u>{{ cond_coop_action|safe }}</u></b> </div>
                <div class="proportion" data-value="60"> {{ cond_coop_60|safe }} <b><u>{{ cond_coop_action|safe }}</u></b> </div>
                <div class="proportion" data-value="70"> {{ cond_coop_70|safe }} <b><u>{{ cond_coop_action|safe }}</u></b> </div>
            </div>

            <!-- Right: continuation of the sentence -->
            <div class="proportion-completion">
                <b>{{ cond_coop_completion|safe }} </b>
            </div>
        </div>

        <!-- New full-width unconditional option below -->
        <div class="proportion-fullwidth" data-value="100">
            {{ unconditional_keep|safe }}
        </div>


        <div id="error-message" style="display: none; color: red; text-align: center; margin-top: 10px;">
            {{ error1|safe }}
        </div>


        <br>

        <p style="text-align: center; ">
            {{ cond_coop_incentive|safe }}
        </p>


    <br>

    <div style="display: flex; justify-content: flex-end">
        <button style="color: #fff;
                       background-color: #007bff;
                       border: 1px solid #007bff;
                       font-size: 1rem;
                       border-radius: 0.25rem;
                       padding: 4px 12px;" type="button" id="submit-button">
            {{ button_next|safe }}
        </button>
    </div>

    </div>


</form>




</body>
</html>



{{ endblock }}
